<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–£–º–Ω—ã–π –±—É–¥–∏–ª—å–Ω–∏–∫ | –†–∞–±–æ—Ç–∞—é—â–∏–µ Push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <style>
        /* –í—Å–µ —Å—Ç–∏–ª–∏ –æ—Å—Ç–∞—é—Ç—Å—è —Ç–æ—á–Ω–æ —Ç–∞–∫–∏–º–∏ –∂–µ */
        :root {
            --primary: #4A6FA5;
            --secondary: #2E5077;
            --accent: #FF6B6B;
            --dark: #1A2D42;
            --light: #F5F7FA;
            --success: #4ECDC4;
            --warning: #FFD166;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Montserrat', 'Segoe UI', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, var(--dark) 0%, #0F1A2B 100%);
            color: var(--light);
            min-height: 100vh;
            overflow-x: hidden;
            padding: 10px;
        }
        
        .container {
            max-width: 100%;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        header {
            text-align: center;
            padding: 20px 15px;
            background: rgba(26, 45, 66, 0.7);
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(74, 111, 165, 0.2);
            position: relative;
            overflow: hidden;
        }
        
        header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--accent), var(--success));
        }
        
        h1 {
            font-size: 1.8rem;
            margin-bottom: 10px;
            background: linear-gradient(90deg, var(--primary), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
            letter-spacing: 0.5px;
        }
        
        .tagline {
            font-size: 1rem;
            max-width: 100%;
            margin: 0 auto;
            color: rgba(245, 247, 250, 0.8);
            line-height: 1.5;
        }
        
        .notification-permission {
            background: rgba(255, 107, 107, 0.2);
            border: 1px solid var(--accent);
            border-radius: 10px;
            padding: 12px 15px;
            margin: 10px 0;
            text-align: center;
            font-size: 0.9rem;
        }
        
        .notification-permission button {
            background: var(--accent);
            margin-top: 8px;
        }
        
        .push-status {
            background: rgba(78, 205, 196, 0.2);
            border: 1px solid var(--success);
            border-radius: 10px;
            padding: 10px 15px;
            margin: 8px 0;
            font-size: 0.85rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .push-status.active {
            animation: pulse 2s infinite;
        }
        
        .tabs {
            display: flex;
            background: rgba(26, 45, 66, 0.7);
            border-radius: 12px;
            padding: 3px;
            margin-bottom: 15px;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        .tab {
            flex: 1;
            padding: 12px 8px;
            text-align: center;
            background: transparent;
            border: none;
            color: var(--light);
            font-weight: bold;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            min-width: 140px;
        }
        
        .tab.active {
            background: var(--primary);
            box-shadow: 0 3px 10px rgba(74, 111, 165, 0.4);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .map-container {
            width: 100%;
            height: 300px;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.4);
            position: relative;
            border: 1px solid rgba(74, 111, 165, 0.3);
        }
        
        #map {
            height: 100%;
            width: 100%;
            border-radius: 15px;
        }
        
        .map-overlay {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(26, 45, 66, 0.9);
            padding: 8px 15px;
            border-radius: 50px;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 8px;
            backdrop-filter: blur(5px);
            border: 1px solid var(--primary);
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            font-size: 0.9rem;
        }
        
        .location-controls {
            position: absolute;
            bottom: 15px;
            right: 10px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 1000;
        }
        
        .location-btn {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: var(--primary);
            border: none;
            color: white;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.3);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .location-btn:active {
            transform: scale(0.95);
        }
        
        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: var(--success);
            animation: pulse 2s infinite;
        }
        
        .controls {
            width: 100%;
            background: rgba(26, 45, 66, 0.7);
            padding: 20px 15px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(74, 111, 165, 0.2);
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .control-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .section-title {
            font-size: 1.1rem;
            margin-bottom: 5px;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .section-title::before {
            content: '';
            width: 4px;
            height: 16px;
            background: var(--accent);
            border-radius: 2px;
        }
        
        label {
            font-weight: bold;
            font-size: 0.95rem;
            color: rgba(245, 247, 250, 0.9);
        }
        
        input, select, textarea, button {
            padding: 14px 16px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            background: rgba(245, 247, 250, 0.1);
            color: var(--light);
            border: 1px solid rgba(74, 111, 165, 0.3);
            transition: all 0.3s ease;
            width: 100%;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(74, 111, 165, 0.2);
        }
        
        input::placeholder, textarea::placeholder {
            color: rgba(245, 247, 250, 0.5);
        }
        
        .range-container {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .range-value {
            min-width: 50px;
            text-align: center;
            font-weight: bold;
            background: var(--primary);
            padding: 5px 8px;
            border-radius: 6px;
            font-size: 0.9rem;
        }
        
        button {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 8px;
            position: relative;
            overflow: hidden;
            font-size: 1rem;
            letter-spacing: 0.5px;
            padding: 16px;
        }
        
        button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: 0.5s;
        }
        
        button:hover::before {
            left: 100%;
        }
        
        button:active {
            transform: translateY(2px);
        }
        
        button:disabled {
            background: rgba(245, 247, 250, 0.1);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        button:disabled::before {
            display: none;
        }
        
        .status-panel {
            padding: 15px;
            border-radius: 10px;
            background: rgba(0, 0, 0, 0.3);
            margin-top: 8px;
            border-left: 3px solid var(--primary);
            font-size: 0.9rem;
        }
        
        .alarm-active {
            animation: alarm-pulse 1.5s infinite;
            border-left-color: var(--accent);
            background: rgba(255, 107, 107, 0.2);
        }
        
        .distance-info {
            font-size: 1.2rem;
            font-weight: bold;
            text-align: center;
            padding: 12px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            border: 1px solid rgba(74, 111, 165, 0.3);
            margin: 8px 0;
            position: relative;
            overflow: hidden;
        }
        
        .distance-info::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(74, 111, 165, 0.1), transparent);
            transform: translateX(-100%);
        }
        
        .distance-info.active::before {
            animation: shimmer 3s infinite;
        }
        
        .alarms-list {
            max-height: 200px;
            overflow-y: auto;
            padding: 8px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .alarm-item {
            padding: 10px 12px;
            background: rgba(74, 111, 165, 0.1);
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid rgba(74, 111, 165, 0.3);
        }
        
        .alarm-name {
            font-weight: bold;
            font-size: 0.95rem;
        }
        
        .alarm-details {
            font-size: 0.8rem;
            color: rgba(245, 247, 250, 0.7);
        }
        
        .active-alarm {
            background: rgba(78, 205, 196, 0.15);
            border-color: rgba(78, 205, 196, 0.5);
        }
        
        footer {
            text-align: center;
            padding: 15px;
            margin-top: 15px;
            font-size: 0.8rem;
            opacity: 0.7;
            border-top: 1px solid rgba(74, 111, 165, 0.2);
        }
        
        .current-time {
            font-size: 1.3rem;
            text-align: center;
            padding: 12px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            margin: 8px 0;
            font-weight: bold;
        }
        
        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        .action-buttons button {
            flex: 1;
        }
        
        .user-location-marker {
            background: var(--accent);
            border: 3px solid white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            box-shadow: 0 0 10px var(--accent);
            animation: pulse 2s infinite;
        }
        
        .custom-sounds-section {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            padding: 15px;
            margin-top: 10px;
        }
        
        .custom-sounds-list {
            max-height: 150px;
            overflow-y: auto;
            margin: 10px 0;
        }
        
        .custom-sound-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 10px;
            background: rgba(74, 111, 165, 0.1);
            border-radius: 8px;
            margin-bottom: 8px;
        }
        
        .sound-name {
            font-size: 0.9rem;
        }
        
        .sound-controls {
            display: flex;
            gap: 5px;
        }
        
        .sound-btn {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: var(--primary);
            border: none;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 0.8rem;
        }
        
        .file-upload-container {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        .file-upload-label {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 12px;
            background: rgba(74, 111, 165, 0.2);
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            text-align: center;
        }
        
        #audioUpload {
            display: none;
        }
        
        .notification-settings {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }
        
        .notification-settings label {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
        }
        
        .notification-settings input[type="checkbox"] {
            width: 20px;
            height: 20px;
        }
        
        .solution-info {
            background: rgba(255, 215, 102, 0.2);
            border: 1px solid var(--warning);
            border-radius: 10px;
            padding: 12px 15px;
            margin: 10px 0;
            font-size: 0.85rem;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }
        
        @keyframes alarm-pulse {
            0% { box-shadow: 0 0 0 0 rgba(255, 107, 107, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(255, 107, 107, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 107, 107, 0); }
        }
        
        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        
        /* –£–ª—É—á—à–µ–Ω–∏—è –¥–ª—è –æ—á–µ–Ω—å –º–∞–ª–µ–Ω—å–∫–∏—Ö —ç–∫—Ä–∞–Ω–æ–≤ */
        @media (max-width: 360px) {
            h1 {
                font-size: 1.5rem;
            }
            
            .tab {
                font-size: 0.8rem;
                min-width: 120px;
                padding: 10px 6px;
            }
            
            .map-overlay {
                font-size: 0.8rem;
                padding: 6px 12px;
            }
            
            input, select, textarea, button {
                padding: 12px 14px;
            }
        }
        
        /* –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–∞—è –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏—è */
        @media (min-width: 768px) and (max-height: 500px) {
            .container {
                max-width: 100%;
            }
            
            .map-container {
                height: 400px;
            }
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <header>
            <h1>–£–ú–ù–´–ô –ë–£–î–ò–õ–¨–ù–ò–ö</h1>
            <p class="tagline">–°–∏–≥–Ω–∞–ª—ã –ø–æ –≤—Ä–µ–º–µ–Ω–∏ –∏ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—é —Å —Ä–∞–±–æ—Ç–∞—é—â–∏–º–∏ Push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏</p>
            
            <div class="solution-info">
                <p><strong>Push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∞–∫—Ç–∏–≤–Ω—ã!</strong> –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –±—É–¥—É—Ç –ø—Ä–∏—Ö–æ–¥–∏—Ç—å –¥–∞–∂–µ –∫–æ–≥–¥–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–∫—Ä—ã—Ç–æ.</p>
            </div>
            
            <div class="notification-permission" id="notificationPermission" style="display: none;">
                <p>–î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π —Ä–∞–∑—Ä–µ—à–∏—Ç–µ –¥–æ—Å—Ç—É–ø –∫ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º –≤ –±—Ä–∞—É–∑–µ—Ä–µ</p>
                <button id="enableNotificationsBtn">–†–∞–∑—Ä–µ—à–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</button>
            </div>
            
            <div class="push-status" id="pushStatus">
                <span>–°—Ç–∞—Ç—É—Å push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π:</span>
                <span id="pushStatusText">–ü—Ä–æ–≤–µ—Ä–∫–∞...</span>
            </div>
        </header>
        
        <div class="tabs">
            <button class="tab active" data-tab="location">–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è</button>
            <button class="tab" data-tab="time">–ü–æ –≤—Ä–µ–º–µ–Ω–∏</button>
            <button class="tab" data-tab="sounds">–ú–æ–∏ –∑–≤—É–∫–∏</button>
        </div>
        
        <div class="map-container">
            <div id="map"></div>
            <div class="map-overlay">
                <div class="status-dot"></div>
                <span>–°–∏–≥–Ω–∞–ª–æ–≤: <span id="activeAlarmsCount">0</span></span>
            </div>
            <div class="location-controls">
                <button class="location-btn" id="locateUser" title="–ù–∞–π—Ç–∏ –º–µ–Ω—è">üìç</button>
                <button class="location-btn" id="trackUser" title="–°–ª–µ–¥–∏—Ç—å –∑–∞ –º–Ω–æ–π">üëÅÔ∏è</button>
            </div>
        </div>
        
        <div class="controls">
            <div class="tab-content active" id="location-tab">
                <div class="control-group">
                    <div class="section-title">–ì–µ–æ–ª–æ–∫–∞—Ü–∏–æ–Ω–Ω—ã–π —Å–∏–≥–Ω–∞–ª</div>
                    
                    <label for="alarmName">–ù–∞–∑–≤–∞–Ω–∏–µ:</label>
                    <input type="text" id="alarmName" placeholder="–†–∞–±–æ—Ç–∞, –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞...">
                    
                    <label for="alarmRadius">–†–∞–¥–∏—É—Å (–º–µ—Ç—Ä—ã):</label>
                    <div class="range-container">
                        <input type="range" id="alarmRadius" min="50" max="2000" value="300">
                        <div class="range-value" id="radiusValue">300 –º</div>
                    </div>
                    
                    <label for="alarmSound">–¢–∏–ø —Å–∏–≥–Ω–∞–ª–∞:</label>
                    <select id="alarmSound">
                        <option value="standard">–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π</option>
                        <option value="melodic">–ú–µ–ª–æ–¥–∏—á–Ω—ã–π</option>
                        <option value="vibration">–í–∏–±—Ä–∞—Ü–∏—è</option>
                        <option value="custom">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∑–≤—É–∫</option>
                    </select>
                    
                    <label for="alarmMessage">–°–æ–æ–±—â–µ–Ω–∏–µ:</label>
                    <textarea id="alarmMessage" placeholder="–¢–µ–∫—Å—Ç –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è..." rows="2"></textarea>
                    
                    <div class="notification-settings">
                        <label>
                            <input type="checkbox" id="locationNotification" checked>
                            –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
                        </label>
                    </div>
                    
                    <button id="createAlarmBtn">–°–æ–∑–¥–∞—Ç—å –≥–µ–æ—Å–∏–≥–Ω–∞–ª</button>
                </div>
            </div>
            
            <div class="tab-content" id="time-tab">
                <div class="control-group">
                    <div class="section-title">–í—Ä–µ–º–µ–Ω–Ω–æ–π –±—É–¥–∏–ª—å–Ω–∏–∫</div>
                    
                    <label for="timeAlarmName">–ù–∞–∑–≤–∞–Ω–∏–µ:</label>
                    <input type="text" id="timeAlarmName" placeholder="–ü–æ–¥—ä–µ–º, –û–±–µ–¥...">
                    
                    <label for="alarmTime">–í—Ä–µ–º—è:</label>
                    <input type="time" id="alarmTime">
                    
                    <label for="repeatDays">–ü–æ–≤—Ç–æ—Ä:</label>
                    <select id="repeatDays">
                        <option value="once">–û–¥–∏–Ω —Ä–∞–∑</option>
                        <option value="daily">–ï–∂–µ–¥–Ω–µ–≤–Ω–æ</option>
                        <option value="weekdays">–ü–æ –±—É–¥–Ω—è–º</option>
                        <option value="weekends">–ü–æ –≤—ã—Ö–æ–¥–Ω—ã–º</option>
                    </select>
                    
                    <label for="timeAlarmSound">–¢–∏–ø —Å–∏–≥–Ω–∞–ª–∞:</label>
                    <select id="timeAlarmSound">
                        <option value="standard">–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π</option>
                        <option value="melodic">–ú–µ–ª–æ–¥–∏—á–Ω—ã–π</option>
                        <option value="vibration">–í–∏–±—Ä–∞—Ü–∏—è</option>
                        <option value="custom">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∑–≤—É–∫</option>
                    </select>
                    
                    <label for="timeAlarmMessage">–°–æ–æ–±—â–µ–Ω–∏–µ:</label>
                    <textarea id="timeAlarmMessage" placeholder="–¢–µ–∫—Å—Ç –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è..." rows="2"></textarea>
                    
                    <div class="notification-settings">
                        <label>
                            <input type="checkbox" id="timeNotification" checked>
                            –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
                        </label>
                    </div>
                    
                    <button id="createTimeAlarmBtn">–°–æ–∑–¥–∞—Ç—å –±—É–¥–∏–ª—å–Ω–∏–∫</button>
                </div>
            </div>
            
            <div class="tab-content" id="sounds-tab">
                <div class="control-group">
                    <div class="section-title">–ó–∞–≥—Ä—É–∑–∫–∞ –∑–≤—É–∫–æ–≤</div>
                    
                    <p>–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Å–≤–æ–∏ –∑–≤—É–∫–∏ –¥–ª—è –±—É–¥–∏–ª—å–Ω–∏–∫–æ–≤ (MP3, WAV, OGG)</p>
                    
                    <div class="file-upload-container">
                        <label for="audioUpload" class="file-upload-label">
                            üìÅ –í—ã–±—Ä–∞—Ç—å –∑–≤—É–∫–æ–≤–æ–π —Ñ–∞–π–ª
                        </label>
                        <input type="file" id="audioUpload" accept="audio/*">
                        <button id="uploadSoundBtn">–ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
                    </div>
                    
                    <div class="custom-sounds-section">
                        <div class="section-title">–ú–æ–∏ –∑–≤—É–∫–∏</div>
                        <div class="custom-sounds-list" id="customSoundsList">
                            <div class="custom-sound-item">
                                <span class="sound-name">–ü–æ–∫–∞ –Ω–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –∑–≤—É–∫–æ–≤</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="control-group">
                <div class="section-title">–¢–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è</div>
                <div class="current-time" id="currentTime">--:--:--</div>
            </div>
            
            <div class="control-group">
                <div class="section-title">–ú–æ–∏ —Å–∏–≥–Ω–∞–ª—ã</div>
                <div class="alarms-list" id="alarmsList">
                    <div class="alarm-item">
                        <span class="alarm-name">–ü–æ–∫–∞ –Ω–µ—Ç —Å–∏–≥–Ω–∞–ª–æ–≤</span>
                    </div>
                </div>
            </div>
            
            <div class="control-group">
                <div class="section-title">–ù–∞–≤–∏–≥–∞—Ü–∏—è</div>
                
                <label>–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:</label>
                <div class="status-panel" id="locationStatus">–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è...</div>
                
                <label>–†–∞—Å—Å—Ç–æ—è–Ω–∏–µ –¥–æ —Ü–µ–ª–∏:</label>
                <div class="distance-info" id="distanceInfo">-</div>
                
                <label>–°—Ç–∞—Ç—É—Å:</label>
                <div class="status-panel" id="alarmStatus">–°–∏—Å—Ç–µ–º–∞ –∞–∫—Ç–∏–≤–Ω–∞</div>
                
                <div class="action-buttons">
                    <button id="clearAlarmsBtn">–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ</button>
                    <button id="testAlarmBtn">–¢–µ—Å—Ç push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</button>
                </div>
            </div>
        </div>
        
        <footer>
            <p>–£–º–Ω—ã–π –±—É–¥–∏–ª—å–Ω–∏–∫ &copy; 2023 | –†–∞–±–æ—Ç–∞—é—â–∏–µ push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</p>
        </footer>
    </div>

    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script>
        // –û—Å–Ω–æ–≤–Ω–æ–π –∫–ª–∞—Å—Å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        class SmartAlarm {
            constructor() {
                this.map = null;
                this.userMarker = null;
                this.userAccuracyCircle = null;
                this.alarms = [];
                this.customSounds = [];
                this.watchId = null;
                this.closestAlarm = null;
                this.currentTimeInterval = null;
                this.isTracking = false;
                this.selectedFile = null;
                this.notificationPermission = false;
                this.serviceWorkerRegistration = null;
                
                this.init();
            }
            
            init() {
                this.initMap();
                this.initElements();
                this.initEventListeners();
                this.loadCustomSounds();
                this.checkNotificationPermission();
                this.startTimeUpdates();
                this.startAlarmChecks();
                this.createDemoAlarm();
            }
            
            initMap() {
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ä—Ç—ã
                this.map = L.map('map').setView([55.7558, 37.6173], 13);
                
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
                }).addTo(this.map);
                
                // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –ø–æ –∫–∞—Ä—Ç–µ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –≥–µ–æ—Å–∏–≥–Ω–∞–ª–∞
                this.map.on('click', (e) => {
                    this.createLocationAlarmFromForm(e.latlng);
                });
            }
            
            initElements() {
                // –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Å—ã–ª–æ–∫ –Ω–∞ DOM —ç–ª–µ–º–µ–Ω—Ç—ã
                this.elements = {
                    locationStatus: document.getElementById('locationStatus'),
                    distanceInfo: document.getElementById('distanceInfo'),
                    alarmStatus: document.getElementById('alarmStatus'),
                    createAlarmBtn: document.getElementById('createAlarmBtn'),
                    createTimeAlarmBtn: document.getElementById('createTimeAlarmBtn'),
                    clearAlarmsBtn: document.getElementById('clearAlarmsBtn'),
                    testAlarmBtn: document.getElementById('testAlarmBtn'),
                    locateUserBtn: document.getElementById('locateUser'),
                    trackUserBtn: document.getElementById('trackUser'),
                    uploadSoundBtn: document.getElementById('uploadSoundBtn'),
                    audioUpload: document.getElementById('audioUpload'),
                    enableNotificationsBtn: document.getElementById('enableNotificationsBtn'),
                    notificationPermissionDiv: document.getElementById('notificationPermission'),
                    pushStatus: document.getElementById('pushStatus'),
                    pushStatusText: document.getElementById('pushStatusText'),
                    alarmRadius: document.getElementById('alarmRadius'),
                    radiusValue: document.getElementById('radiusValue'),
                    alarmsList: document.getElementById('alarmsList'),
                    customSoundsList: document.getElementById('customSoundsList'),
                    activeAlarmsCount: document.getElementById('activeAlarmsCount'),
                    currentTime: document.getElementById('currentTime'),
                    tabs: document.querySelectorAll('.tab'),
                    tabContents: document.querySelectorAll('.tab-content')
                };
            }
            
            initEventListeners() {
                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è —Ä–∞–¥–∏—É—Å–∞
                this.elements.alarmRadius.addEventListener('input', () => {
                    this.elements.radiusValue.textContent = `${this.elements.alarmRadius.value} –º`;
                });
                
                // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∫–ª–∞–¥–æ–∫
                this.elements.tabs.forEach(tab => {
                    tab.addEventListener('click', () => {
                        const tabId = tab.getAttribute('data-tab');
                        
                        // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —É –≤—Å–µ—Ö –≤–∫–ª–∞–¥–æ–∫ –∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
                        this.elements.tabs.forEach(t => t.classList.remove('active'));
                        this.elements.tabContents.forEach(c => c.classList.remove('active'));
                        
                        // –î–æ–±–∞–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å –∫ –≤—ã–±—Ä–∞–Ω–Ω–æ–π –≤–∫–ª–∞–¥–∫–µ –∏ –∫–æ–Ω—Ç–µ–Ω—Ç—É
                        tab.classList.add('active');
                        document.getElementById(`${tabId}-tab`).classList.add('active');
                    });
                });
                
                // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫
                this.elements.createAlarmBtn.addEventListener('click', () => {
                    alert("–ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –∫–∞—Ä—Ç–µ, —á—Ç–æ–±—ã —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≥–µ–æ–ª–æ–∫–∞—Ü–∏–æ–Ω–Ω—ã–π —Å–∏–≥–Ω–∞–ª");
                });
                
                this.elements.createTimeAlarmBtn.addEventListener('click', () => {
                    this.createTimeAlarm();
                });
                
                this.elements.clearAlarmsBtn.addEventListener('click', () => {
                    this.clearAllAlarms();
                });
                
                this.elements.testAlarmBtn.addEventListener('click', () => {
                    this.testAlarm();
                });
                
                this.elements.locateUserBtn.addEventListener('click', () => {
                    this.locateUser();
                });
                
                this.elements.trackUserBtn.addEventListener('click', () => {
                    this.toggleTracking();
                });
                
                this.elements.uploadSoundBtn.addEventListener('click', () => {
                    this.uploadSound();
                });
                
                this.elements.audioUpload.addEventListener('change', (e) => {
                    this.handleFileSelect(e);
                });
                
                this.elements.enableNotificationsBtn.addEventListener('click', () => {
                    this.requestNotificationPermission();
                });
            }
            
            // Service Worker –∏ Push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
            async registerServiceWorker() {
                if ('serviceWorker' in navigator) {
                    try {
                        // –°–æ–∑–¥–∞–µ–º –ø—Ä–æ—Å—Ç–æ–π Service Worker –∫–æ–¥
                        const swCode = `
                            self.addEventListener('install', (event) => {
                                console.log('Service Worker —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω');
                                self.skipWaiting();
                            });
                            
                            self.addEventListener('activate', (event) => {
                                console.log('Service Worker –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω');
                                event.waitUntil(self.clients.claim());
                            });
                            
                            self.addEventListener('push', (event) => {
                                if (!event.data) return;
                                
                                const data = event.data.json();
                                const options = {
                                    body: data.body,
                                    icon: data.icon || '/icon-192x192.png',
                                    badge: '/badge-72x72.png',
                                    tag: 'alarm-push',
                                    requireInteraction: true,
                                    vibrate: [200, 100, 200, 100, 200],
                                    data: data
                                };
                                
                                event.waitUntil(
                                    self.registration.showNotification(data.title, options)
                                );
                            });
                            
                            self.addEventListener('notificationclick', (event) => {
                                event.notification.close();
                                
                                if (event.action === 'snooze') {
                                    // –û—Ç–ª–æ–∂–∏—Ç—å –±—É–¥–∏–ª—å–Ω–∏–∫
                                    console.log('–ë—É–¥–∏–ª—å–Ω–∏–∫ –æ—Ç–ª–æ–∂–µ–Ω');
                                } else if (event.action === 'dismiss') {
                                    console.log('–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∑–∞–∫—Ä—ã—Ç–æ');
                                } else {
                                    // –ö–ª–∏–∫ –ø–æ —Ç–µ–ª—É —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
                                    event.waitUntil(
                                        clients.matchAll({type: 'window'}).then((clientList) => {
                                            for (const client of clientList) {
                                                if (client.url.includes('/') && 'focus' in client) {
                                                    return client.focus();
                                                }
                                            }
                                            if (clients.openWindow) {
                                                return clients.openWindow('/');
                                            }
                                        })
                                    );
                                }
                            });
                        `;
                        
                        // –°–æ–∑–¥–∞–µ–º Blob –∏–∑ –∫–æ–¥–∞ Service Worker
                        const blob = new Blob([swCode], { type: 'application/javascript' });
                        const swUrl = URL.createObjectURL(blob);
                        
                        // –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º Service Worker
                        this.serviceWorkerRegistration = await navigator.serviceWorker.register(swUrl);
                        console.log('Service Worker –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω');
                        
                        // –ñ–¥–µ–º –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ Service Worker
                        await navigator.serviceWorker.ready;
                        console.log('Service Worker –≥–æ—Ç–æ–≤');
                        
                        return this.serviceWorkerRegistration;
                    } catch (error) {
                        console.error('–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ Service Worker:', error);
                        this.elements.pushStatusText.textContent = '–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ SW';
                        return null;
                    }
                } else {
                    console.log('Service Worker –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è');
                    this.elements.pushStatusText.textContent = 'SW –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è';
                    return null;
                }
            }
            
            async subscribeToPush() {
                if (!this.serviceWorkerRegistration) {
                    console.log('Service Worker –Ω–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω');
                    return null;
                }
                
                try {
                    // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –ø–æ–¥–ø–∏—Å–∫—É –∏–ª–∏ —Å–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é
                    let subscription = await this.serviceWorkerRegistration.pushManager.getSubscription();
                    
                    if (!subscription) {
                        // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é –ø–æ–¥–ø–∏—Å–∫—É
                        const vapidPublicKey = 'BEl62iUYgUivxIkv69yViEuiBIa-Ib9-SkvMeAtA3LFgDzkrxZJjSgSnfckjBJuBkr3qBUYIHBQFLXYp5Nksh8U';
                        
                        subscription = await this.serviceWorkerRegistration.pushManager.subscribe({
                            userVisibleOnly: true,
                            applicationServerKey: this.urlBase64ToUint8Array(vapidPublicKey)
                        });
                    }
                    
                    console.log('–ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —É—Å–ø–µ—à–Ω–∞');
                    this.elements.pushStatusText.textContent = '–ê–∫—Ç–∏–≤–Ω—ã';
                    this.elements.pushStatus.classList.add('active');
                    
                    return subscription;
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:', error);
                    this.elements.pushStatusText.textContent = '–û—à–∏–±–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏';
                    
                    if (error.name === 'NotAllowedError') {
                        this.elements.pushStatusText.textContent = '–†–∞–∑—Ä–µ—à–µ–Ω–∏–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–æ';
                    }
                    
                    return null;
                }
            }
            
            urlBase64ToUint8Array(base64String) {
                const padding = '='.repeat((4 - base64String.length % 4) % 4);
                const base64 = (base64String + padding)
                    .replace(/-/g, '+')
                    .replace(/_/g, '/');
                
                const rawData = window.atob(base64);
                const outputArray = new Uint8Array(rawData.length);
                
                for (let i = 0; i < rawData.length; ++i) {
                    outputArray[i] = rawData.charCodeAt(i);
                }
                return outputArray;
            }
            
            async sendPushNotification(title, message) {
                if (!this.serviceWorkerRegistration) {
                    console.log('Service Worker –Ω–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω, –æ—Ç–ø—Ä–∞–≤–∫–∞ –æ–±—ã—á–Ω–æ–≥–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è');
                    this.sendFallbackNotification(title, message);
                    return;
                }
                
                try {
                    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Service Worker
                    await this.serviceWorkerRegistration.showNotification(title, {
                        body: message,
                        icon: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjQiIGhlaWdodD0iNjQiIHZpZXdCb3g9IjAgMCA2NCA2NCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTMyIDhDNDEuOTUxIDggNTAgMTYuMDQ5IDUwIDI2VjQwTDU0IDQ0SDMySDZMMTAgNDBWMjZDMTAgMTYuMDQ5IDE4LjA0OSA4IDMyIDhaTTI0IDUwSDQwQzQwIDUzLjMxMzcgMzcuMzEzNyA1NiAzNCA1NkgyNkMyOS4zMTM3IDU2IDMyIDUzLjMxMzcgMzIgNTBaIiBmaWxsPSIjNEhGQjZCIi8+Cjwvc3ZnPg==',
                        badge: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjQiIGhlaWdodD0iNjQiIHZpZXdCb3g9IjAgMCA2NCA2NCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTMyIDhDNDEuOTUxIDggNTAgMTYuMDQ5IDUwIDI2VjQwTDU0IDQ0SDMySDZMMTAgNDBWMjZDMTAgMTYuMDQ5IDE4LjA0OSA4IDMyIDhaTTI0IDUwSDQwQzQwIDUzLjMxMzcgMzcuMzEzNyA1NiAzNCA1NkgyNkMyOS4zMTM3IDU2IDMyIDUzLjMxMzcgMzIgNTBaIiBmaWxsPSIjNEhGQjZCIi8+Cjwvc3ZnPg==',
                        tag: 'alarm-push',
                        requireInteraction: true,
                        vibrate: [200, 100, 200, 100, 200],
                        actions: [
                            {
                                action: 'snooze',
                                title: '–û—Ç–ª–æ–∂–∏—Ç—å'
                            },
                            {
                                action: 'dismiss',
                                title: '–ó–∞–∫—Ä—ã—Ç—å'
                            }
                        ]
                    });
                    
                    console.log('Push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ —á–µ—Ä–µ–∑ Service Worker');
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:', error);
                    this.sendFallbackNotification(title, message);
                }
            }
            
            sendFallbackNotification(title, message) {
                if (!this.notificationPermission) return;
                
                try {
                    const notification = new Notification(title, {
                        body: message,
                        icon: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjQiIGhlaWdodD0iNjQiIHZpZXdCb3g9IjAgMCA2NCA2NCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTMyIDhDNDEuOTUxIDggNTAgMTYuMDQ5IDUwIDI2VjQwTDU0IDQ0SDMySDZMMTAgNDBWMjZDMTAgMTYuMDQ5IDE4LjA0OSA4IDMyIDhaTTI0IDUwSDQwQzQwIDUzLjMxMzcgMzcuMzEzNyA1NiAzNCA1NkgyNkMyOS4zMTM3IDU2IDMyIDUzLjMxMzcgMzIgNTBaIiBmaWxsPSIjNEhGQjZCIi8+Cjwvc3ZnPg==',
                        tag: 'alarm-fallback',
                        requireInteraction: true
                    });
                    
                    notification.onclick = function() {
                        window.focus();
                        this.close();
                    };
                    
                    console.log('–†–µ–∑–µ—Ä–≤–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ');
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:', error);
                }
            }
            
            async checkNotificationPermission() {
                if (!("Notification" in window)) {
                    console.log("–ë—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è");
                    this.elements.pushStatusText.textContent = '–ù–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è';
                    return;
                }
                
                if (Notification.permission === "granted") {
                    this.notificationPermission = true;
                    this.elements.notificationPermissionDiv.style.display = 'none';
                    
                    // –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º Service Worker –∏ –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ–º—Å—è –Ω–∞ push
                    await this.registerServiceWorker();
                    await this.subscribeToPush();
                    
                } else if (Notification.permission === "denied") {
                    this.notificationPermission = false;
                    this.elements.notificationPermissionDiv.style.display = 'block';
                    this.elements.pushStatusText.textContent = '–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã';
                } else {
                    this.notificationPermission = false;
                    this.elements.notificationPermissionDiv.style.display = 'block';
                    this.elements.pushStatusText.textContent = '–¢—Ä–µ–±—É–µ—Ç—Å—è —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ';
                }
            }
            
            async requestNotificationPermission() {
                if (!("Notification" in window)) {
                    alert("–í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è");
                    return;
                }
                
                const permission = await Notification.requestPermission();
                
                if (permission === "granted") {
                    this.notificationPermission = true;
                    this.elements.notificationPermissionDiv.style.display = 'none';
                    
                    // –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º Service Worker –∏ –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ–º—Å—è –Ω–∞ push
                    await this.registerServiceWorker();
                    await this.subscribeToPush();
                    
                    // –¢–µ—Å—Ç–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
                    this.sendPushNotification("–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤–∫–ª—é—á–µ–Ω—ã", "–¢–µ–ø–µ—Ä—å –≤—ã –±—É–¥–µ—Ç–µ –ø–æ–ª—É—á–∞—Ç—å push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ—Ç –±—É–¥–∏–ª—å–Ω–∏–∫–∞");
                } else {
                    this.notificationPermission = false;
                    this.elements.notificationPermissionDiv.style.display = 'block';
                    this.elements.pushStatusText.textContent = '–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã';
                }
            }
            
            // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–≤—É–∫–∞–º–∏
            loadCustomSounds() {
                const savedSounds = localStorage.getItem('customSounds');
                if (savedSounds) {
                    this.customSounds = JSON.parse(savedSounds);
                    this.updateCustomSoundsList();
                }
            }
            
            saveCustomSounds() {
                localStorage.setItem('customSounds', JSON.stringify(this.customSounds));
            }
            
            updateCustomSoundsList() {
                this.elements.customSoundsList.innerHTML = '';
                
                if (this.customSounds.length === 0) {
                    this.elements.customSoundsList.innerHTML = '<div class="custom-sound-item"><span class="sound-name">–ü–æ–∫–∞ –Ω–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –∑–≤—É–∫–æ–≤</span></div>';
                    return;
                }
                
                this.customSounds.forEach((sound, index) => {
                    const soundElement = document.createElement('div');
                    soundElement.className = 'custom-sound-item';
                    soundElement.innerHTML = `
                        <span class="sound-name">${sound.name}</span>
                        <div class="sound-controls">
                            <button class="sound-btn play-sound" data-index="${index}" title="–í–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏">‚ñ∂Ô∏è</button>
                            <button class="sound-btn delete-sound" data-index="${index}" title="–£–¥–∞–ª–∏—Ç—å">üóëÔ∏è</button>
                        </div>
                    `;
                    this.elements.customSoundsList.appendChild(soundElement);
                });
                
                // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –∏ —É–¥–∞–ª–µ–Ω–∏—è
                document.querySelectorAll('.play-sound').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const index = parseInt(e.target.closest('.play-sound').getAttribute('data-index'));
                        this.playCustomSound(index);
                    });
                });
                
                document.querySelectorAll('.delete-sound').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const index = parseInt(e.target.closest('.delete-sound').getAttribute('data-index'));
                        this.deleteCustomSound(index);
                    });
                });
            }
            
            playCustomSound(index) {
                if (index >= 0 && index < this.customSounds.length) {
                    const sound = this.customSounds[index];
                    const audio = new Audio(sound.data);
                    audio.play().catch(e => {
                        console.log("–û—à–∏–±–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –∑–≤—É–∫–∞:", e);
                        alert("–ù–µ —É–¥–∞–ª–æ—Å—å –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏ –∑–≤—É–∫. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞.");
                    });
                }
            }
            
            deleteCustomSound(index) {
                if (index >= 0 && index < this.customSounds.length) {
                    if (confirm(`–£–¥–∞–ª–∏—Ç—å –∑–≤—É–∫ "${this.customSounds[index].name}"?`)) {
                        this.customSounds.splice(index, 1);
                        this.saveCustomSounds();
                        this.updateCustomSoundsList();
                    }
                }
            }
            
            handleFileSelect(e) {
                if (e.target.files.length > 0) {
                    this.selectedFile = e.target.files[0];
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–º—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞
                    document.querySelector('.file-upload-label').textContent = `üìÅ ${this.selectedFile.name}`;
                }
            }
            
            uploadSound() {
                if (!this.selectedFile) {
                    alert("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –∑–≤—É–∫–æ–≤–æ–π —Ñ–∞–π–ª");
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = (e) => {
                    const soundData = e.target.result;
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ 5MB)
                    if (this.selectedFile.size > 5 * 1024 * 1024) {
                        alert("–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π. –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä - 5MB.");
                        return;
                    }
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º –∑–≤—É–∫ –≤ —Å–ø–∏—Å–æ–∫
                    this.customSounds.push({
                        name: this.selectedFile.name,
                        data: soundData
                    });
                    
                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏ –æ–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫
                    this.saveCustomSounds();
                    this.updateCustomSoundsList();
                    
                    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—ã–±–æ—Ä —Ñ–∞–π–ª–∞
                    this.selectedFile = null;
                    this.elements.audioUpload.value = '';
                    document.querySelector('.file-upload-label').textContent = 'üìÅ –í—ã–±—Ä–∞—Ç—å –∑–≤—É–∫–æ–≤–æ–π —Ñ–∞–π–ª';
                    
                    alert("–ó–≤—É–∫ —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω!");
                };
                
                reader.readAsDataURL(this.selectedFile);
            }
            
            // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∏–≥–Ω–∞–ª–∞–º–∏
            createLocationAlarmFromForm(latlng) {
                const alarmName = document.getElementById('alarmName').value || `–°–∏–≥–Ω–∞–ª ${this.alarms.length + 1}`;
                const alarmMessage = document.getElementById('alarmMessage').value || "–í—ã –¥–æ—Å—Ç–∏–≥–ª–∏ —Ü–µ–ª–∏!";
                const radius = parseInt(document.getElementById('alarmRadius').value);
                const soundType = document.getElementById('alarmSound').value;
                const showNotification = document.getElementById('locationNotification').checked;
                
                this.createLocationAlarm(latlng, alarmName, alarmMessage, radius, soundType, showNotification);
            }
            
            createLocationAlarm(latlng, name, message, radius, soundType, showNotification) {
                const alarmId = 'alarm_' + Date.now();
                
                // –°–æ–∑–¥–∞–µ–º –≤–∏–∑—É–∞–ª—å–Ω–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —Å–∏–≥–Ω–∞–ª–∞
                const alarmCircle = L.circle(latlng, {
                    color: '#4A6FA5',
                    fillColor: '#4A6FA5',
                    fillOpacity: 0.2,
                    radius: radius
                }).addTo(this.map);
                
                const alarmMarker = L.marker(latlng).addTo(this.map).bindPopup(`
                    <div style="text-align: center; padding: 10px;">
                        <h3 style="margin: 0 0 10px 0; color: #4A6FA5;">${name}</h3>
                        <p style="margin: 0;">${message}</p>
                        <p style="margin: 10px 0 0 0; font-size: 0.9em; color: #777;">–†–∞–¥–∏—É—Å: ${radius} –º</p>
                    </div>
                `);
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–∏–≥–Ω–∞–ª
                const alarm = {
                    id: alarmId,
                    type: 'location',
                    name: name,
                    message: message,
                    latlng: latlng,
                    radius: radius,
                    soundType: soundType,
                    circle: alarmCircle,
                    marker: alarmMarker,
                    active: true,
                    showNotification: showNotification
                };
                
                this.alarms.push(alarm);
                this.updateAlarmsList();
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å
                this.elements.alarmStatus.textContent = `–ì–µ–æ—Å–∏–≥–Ω–∞–ª "${name}" —Å–æ–∑–¥–∞–Ω!`;
                setTimeout(() => {
                    this.elements.alarmStatus.textContent = "–°–∏—Å—Ç–µ–º–∞ –∞–∫—Ç–∏–≤–Ω–∞";
                }, 3000);
            }
            
            createTimeAlarm() {
                const alarmName = document.getElementById('timeAlarmName').value || `–ë—É–¥–∏–ª—å–Ω–∏–∫ ${this.alarms.length + 1}`;
                const alarmMessage = document.getElementById('timeAlarmMessage').value || "–í—Ä–µ–º—è –ø—Ä–∏—à–ª–æ!";
                const alarmTime = document.getElementById('alarmTime').value;
                const repeatDays = document.getElementById('repeatDays').value;
                const soundType = document.getElementById('timeAlarmSound').value;
                const showNotification = document.getElementById('timeNotification').checked;
                
                if (!alarmTime) {
                    alert("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –≤—Ä–µ–º—è –¥–ª—è –±—É–¥–∏–ª—å–Ω–∏–∫–∞");
                    return;
                }
                
                const alarmId = 'alarm_' + Date.now();
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –±—É–¥–∏–ª—å–Ω–∏–∫
                const alarm = {
                    id: alarmId,
                    type: 'time',
                    name: alarmName,
                    message: alarmMessage,
                    time: alarmTime,
                    repeat: repeatDays,
                    soundType: soundType,
                    active: true,
                    showNotification: showNotification
                };
                
                this.alarms.push(alarm);
                this.updateAlarmsList();
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å
                this.elements.alarmStatus.textContent = `–ë—É–¥–∏–ª—å–Ω–∏–∫ "${alarmName}" –Ω–∞ ${alarmTime} —Å–æ–∑–¥–∞–Ω!`;
                setTimeout(() => {
                    this.elements.alarmStatus.textContent = "–°–∏—Å—Ç–µ–º–∞ –∞–∫—Ç–∏–≤–Ω–∞";
                }, 3000);
            }
            
            updateAlarmsList() {
                this.elements.alarmsList.innerHTML = '';
                this.elements.activeAlarmsCount.textContent = this.alarms.length;
                
                if (this.alarms.length === 0) {
                    this.elements.alarmsList.innerHTML = '<div class="alarm-item"><span class="alarm-name">–ü–æ–∫–∞ –Ω–µ—Ç —Å–∏–≥–Ω–∞–ª–æ–≤</span></div>';
                    return;
                }
                
                this.alarms.forEach(alarm => {
                    const alarmElement = document.createElement('div');
                    alarmElement.className = 'alarm-item';
                    if (alarm === this.closestAlarm) {
                        alarmElement.classList.add('active-alarm');
                    }
                    
                    let details = '';
                    if (alarm.type === 'location') {
                        details = `${alarm.radius} –º`;
                    } else if (alarm.type === 'time') {
                        details = `${alarm.time} (${this.getRepeatText(alarm.repeat)})`;
                    }
                    
                    alarmElement.innerHTML = `
                        <div>
                            <div class="alarm-name">${alarm.name}</div>
                            <div class="alarm-details">${details}</div>
                        </div>
                        <button class="delete-alarm" data-id="${alarm.id}">√ó</button>
                    `;
                    
                    this.elements.alarmsList.appendChild(alarmElement);
                });
                
                // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ —É–¥–∞–ª–µ–Ω–∏—è
                document.querySelectorAll('.delete-alarm').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const alarmId = e.target.closest('.delete-alarm').getAttribute('data-id');
                        this.deleteAlarm(alarmId);
                    });
                });
            }
            
            getRepeatText(repeat) {
                switch(repeat) {
                    case 'once': return '–æ–¥–∏–Ω —Ä–∞–∑';
                    case 'daily': return '–µ–∂–µ–¥–Ω–µ–≤–Ω–æ';
                    case 'weekdays': return '–ø–æ –±—É–¥–Ω—è–º';
                    case 'weekends': return '–ø–æ –≤—ã—Ö–æ–¥–Ω—ã–º';
                    default: return repeat;
                }
            }
            
            deleteAlarm(alarmId) {
                const alarmIndex = this.alarms.findIndex(a => a.id === alarmId);
                if (alarmIndex !== -1) {
                    // –ï—Å–ª–∏ —ç—Ç–æ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–æ–Ω–Ω—ã–π —Å–∏–≥–Ω–∞–ª, —É–¥–∞–ª—è–µ–º —Å –∫–∞—Ä—Ç—ã
                    if (this.alarms[alarmIndex].type === 'location') {
                        this.map.removeLayer(this.alarms[alarmIndex].circle);
                        this.map.removeLayer(this.alarms[alarmIndex].marker);
                    }
                    
                    // –£–¥–∞–ª—è–µ–º –∏–∑ –º–∞—Å—Å–∏–≤–∞
                    this.alarms.splice(alarmIndex, 1);
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫
                    this.updateAlarmsList();
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å
                    this.elements.alarmStatus.textContent = "–°–∏–≥–Ω–∞–ª —É–¥–∞–ª–µ–Ω";
                    setTimeout(() => {
                        this.elements.alarmStatus.textContent = "–°–∏—Å—Ç–µ–º–∞ –∞–∫—Ç–∏–≤–Ω–∞";
                    }, 3000);
                }
            }
            
            clearAllAlarms() {
                if (this.alarms.length === 0) return;
                
                if (confirm("–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –≤—Å–µ —Å–∏–≥–Ω–∞–ª—ã?")) {
                    this.alarms.forEach(alarm => {
                        if (alarm.type === 'location') {
                            this.map.removeLayer(alarm.circle);
                            this.map.removeLayer(alarm.marker);
                        }
                    });
                    
                    this.alarms = [];
                    this.updateAlarmsList();
                    this.closestAlarm = null;
                    this.elements.distanceInfo.textContent = "-";
                    this.elements.distanceInfo.classList.remove('active');
                    
                    this.elements.alarmStatus.textContent = "–í—Å–µ —Å–∏–≥–Ω–∞–ª—ã —É–¥–∞–ª–µ–Ω—ã";
                    setTimeout(() => {
                        this.elements.alarmStatus.textContent = "–°–∏—Å—Ç–µ–º–∞ –∞–∫—Ç–∏–≤–Ω–∞";
                    }, 3000);
                }
            }
            
            testAlarm() {
                this.triggerAlarm({
                    name: "–¢–µ—Å—Ç–æ–≤—ã–π —Å–∏–≥–Ω–∞–ª",
                    message: "–≠—Ç–æ —Ç–µ—Å—Ç–æ–≤–æ–µ push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ!",
                    soundType: "standard",
                    showNotification: true
                });
            }
            
            // –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è
            locateUser() {
                if (this.userMarker) {
                    this.map.setView(this.userMarker.getLatLng(), 16);
                } else {
                    this.getUserLocation();
                }
            }
            
            toggleTracking() {
                this.isTracking = !this.isTracking;
                if (this.isTracking) {
                    this.elements.trackUserBtn.style.background = 'var(--accent)';
                    this.elements.trackUserBtn.title = '–û—Ç–∫–ª—é—á–∏—Ç—å —Å–ª–µ–∂–µ–Ω–∏–µ';
                    if (this.userMarker) {
                        this.map.setView(this.userMarker.getLatLng(), 16);
                    }
                } else {
                    this.elements.trackUserBtn.style.background = 'var(--primary)';
                    this.elements.trackUserBtn.title = '–°–ª–µ–¥–∏—Ç—å –∑–∞ –º–Ω–æ–π';
                }
            }
            
            getUserLocation() {
                if (navigator.geolocation) {
                    // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–µ–µ –ø–æ–ª–æ–∂–µ–Ω–∏–µ –æ–¥–∏–Ω —Ä–∞–∑
                    navigator.geolocation.getCurrentPosition(
                        (position) => {
                            this.updateUserPosition(position);
                        },
                        (error) => {
                            this.elements.locationStatus.textContent = '–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è: ' + error.message;
                        },
                        {
                            enableHighAccuracy: true,
                            timeout: 10000,
                            maximumAge: 0
                        }
                    );
                    
                    // –ù–∞—á–∏–Ω–∞–µ–º –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è
                    if (this.watchId) {
                        navigator.geolocation.clearWatch(this.watchId);
                    }
                    
                    this.watchId = navigator.geolocation.watchPosition(
                        (position) => {
                            this.updateUserPosition(position);
                            this.checkLocationAlarms();
                        },
                        (error) => {
                            this.elements.locationStatus.textContent = '–û—à–∏–±–∫–∞ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è: ' + error.message;
                        },
                        {
                            enableHighAccuracy: true,
                            timeout: 10000,
                            maximumAge: 1000
                        }
                    );
                } else {
                    this.elements.locationStatus.textContent = '–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –≤–∞—à–∏–º –±—Ä–∞—É–∑–µ—Ä–æ–º';
                }
            }
            
            updateUserPosition(position) {
                const userLatLng = [position.coords.latitude, position.coords.longitude];
                const accuracy = position.coords.accuracy;
                
                // –ï—Å–ª–∏ —ç—Ç–æ –ø–µ—Ä–≤—ã–π —Ä–∞–∑, —Ü–µ–Ω—Ç—Ä–∏—Ä—É–µ–º –∫–∞—Ä—Ç—É
                if (!this.userMarker) {
                    this.map.setView(userLatLng, 16);
                    
                    // –°–æ–∑–¥–∞–µ–º –º–∞—Ä–∫–µ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –∫–∞—Å—Ç–æ–º–Ω–æ–π –∏–∫–æ–Ω–∫–æ–π
                    this.userMarker = L.marker(userLatLng, {
                        icon: L.divIcon({
                            className: 'user-location-marker',
                            html: '<div class="user-location-marker"></div>',
                            iconSize: [20, 20],
                            iconAnchor: [10, 10]
                        })
                    }).addTo(this.map).bindPopup('–í–∞—à–µ —Ç–µ–∫—É—â–µ–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ');
                    
                    // –°–æ–∑–¥–∞–µ–º –∫—Ä—É–≥ —Ç–æ—á–Ω–æ—Å—Ç–∏
                    this.userAccuracyCircle = L.circle(userLatLng, {
                        color: '#FF6B6B',
                        fillColor: '#FF6B6B',
                        fillOpacity: 0.2,
                        radius: accuracy
                    }).addTo(this.map);
                } else {
                    this.userMarker.setLatLng(userLatLng);
                    this.userAccuracyCircle.setLatLng(userLatLng);
                    this.userAccuracyCircle.setRadius(accuracy);
                }
                
                // –ï—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–æ —Å–ª–µ–∂–µ–Ω–∏–µ, —Ü–µ–Ω—Ç—Ä–∏—Ä—É–µ–º –∫–∞—Ä—Ç—É –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
                if (this.isTracking) {
                    this.map.setView(userLatLng, this.map.getZoom());
                }
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å
                this.elements.locationStatus.textContent = `–®–∏—Ä–æ—Ç–∞: ${userLatLng[0].toFixed(6)}, –î–æ–ª–≥–æ—Ç–∞: ${userLatLng[1].toFixed(6)}`;
                this.elements.locationStatus.innerHTML += `<br>–¢–æ—á–Ω–æ—Å—Ç—å: ${Math.round(accuracy)} –º`;
            }
            
            checkLocationAlarms() {
                if (!this.userMarker || this.alarms.length === 0) return;
                
                const userLatLng = this.userMarker.getLatLng();
                let minDistance = Infinity;
                let closest = null;
                
                // –ù–∞—Ö–æ–¥–∏–º –±–ª–∏–∂–∞–π—à–∏–π —Å–∏–≥–Ω–∞–ª
                this.alarms.forEach(alarm => {
                    if (alarm.type !== 'location') return;
                    
                    const distance = userLatLng.distanceTo(alarm.latlng);
                    
                    if (distance < minDistance) {
                        minDistance = distance;
                        closest = alarm;
                    }
                    
                    // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ —Ä–∞–¥–∏—É—Å–µ —Å–∏–≥–Ω–∞–ª–∞
                    if (distance <= alarm.radius) {
                        // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º —Å–∏–≥–Ω–∞–ª, –µ—Å–ª–∏ –æ–Ω –µ—â–µ –Ω–µ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω
                        if (alarm.active) {
                            this.triggerAlarm(alarm);
                        }
                    }
                });
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –±–ª–∏–∂–∞–π—à–µ–º —Å–∏–≥–Ω–∞–ª–µ
                this.closestAlarm = closest;
                if (closest) {
                    this.elements.distanceInfo.textContent = `${Math.round(minDistance)} –º –¥–æ "${closest.name}"`;
                    this.elements.distanceInfo.classList.add('active');
                } else {
                    this.elements.distanceInfo.textContent = "-";
                    this.elements.distanceInfo.classList.remove('active');
                }
                
                this.updateAlarmsList();
            }
            
            // –í—Ä–µ–º–µ–Ω–Ω—ã–µ –±—É–¥–∏–ª—å–Ω–∏–∫–∏
            checkTimeAlarms() {
                const now = new Date();
                const currentTimeString = now.toTimeString().substring(0, 5);
                
                this.alarms.forEach(alarm => {
                    if (alarm.type !== 'time') return;
                    
                    if (alarm.time === currentTimeString && alarm.active) {
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω—É–∂–Ω–æ –ª–∏ —Å—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é
                        if (this.shouldTriggerTimeAlarm(alarm, now)) {
                            this.triggerAlarm(alarm);
                            
                            // –ï—Å–ª–∏ –±—É–¥–∏–ª—å–Ω–∏–∫ –Ω–∞ –æ–¥–∏–Ω —Ä–∞–∑, –¥–µ–∞–∫—Ç–∏–≤–∏—Ä—É–µ–º –µ–≥–æ
                            if (alarm.repeat === 'once') {
                                alarm.active = false;
                            }
                        }
                    }
                });
            }
            
            shouldTriggerTimeAlarm(alarm, now) {
                const dayOfWeek = now.getDay(); // 0 - –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ, 1 - –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫, –∏ —Ç.–¥.
                
                switch(alarm.repeat) {
                    case 'once':
                        return true;
                    case 'daily':
                        return true;
                    case 'weekdays':
                        return dayOfWeek >= 1 && dayOfWeek <= 5;
                    case 'weekends':
                        return dayOfWeek === 0 || dayOfWeek === 6;
                    default:
                        return true;
                }
            }
            
            // –ê–∫—Ç–∏–≤–∞—Ü–∏—è —Å–∏–≥–Ω–∞–ª–∞
            triggerAlarm(alarm) {
                // –í–∏–∑—É–∞–ª—å–Ω–æ–µ –æ–ø–æ–≤–µ—â–µ–Ω–∏–µ
                this.elements.alarmStatus.textContent = `–°–ò–ì–ù–ê–õ: ${alarm.message}`;
                this.elements.alarmStatus.classList.add('alarm-active');
                
                // –ó–≤—É–∫–æ–≤–æ–µ –æ–ø–æ–≤–µ—â–µ–Ω–∏–µ
                this.playAlarmSound(alarm.soundType);
                
                // –í–∏–±—Ä–∞—Ü–∏—è (–µ—Å–ª–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è)
                if (navigator.vibrate) {
                    navigator.vibrate([200, 100, 200, 100, 200]);
                }
                
                // Push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–æ)
                if (alarm.showNotification) {
                    this.sendPushNotification(alarm.name, alarm.message);
                }
                
                // –î–µ–∞–∫—Ç–∏–≤–∏—Ä—É–µ–º –≥–µ–æ–ª–æ–∫–∞—Ü–∏–æ–Ω–Ω—ã–π —Å–∏–≥–Ω–∞–ª –Ω–∞ –Ω–µ–∫–æ—Ç–æ—Ä–æ–µ –≤—Ä–µ–º—è
                if (alarm.type === 'location') {
                    alarm.active = false;
                    setTimeout(() => {
                        alarm.active = true;
                        this.elements.alarmStatus.classList.remove('alarm-active');
                        this.elements.alarmStatus.textContent = "–°–∏—Å—Ç–µ–º–∞ –∞–∫—Ç–∏–≤–Ω–∞";
                    }, 10000);
                } else {
                    // –î–ª—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –±—É–¥–∏–ª—å–Ω–∏–∫–æ–≤ —É–±–∏—Ä–∞–µ–º –æ–ø–æ–≤–µ—â–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 10 —Å–µ–∫—É–Ω–¥
                    setTimeout(() => {
                        this.elements.alarmStatus.classList.remove('alarm-active');
                        this.elements.alarmStatus.textContent = "–°–∏—Å—Ç–µ–º–∞ –∞–∫—Ç–∏–≤–Ω–∞";
                    }, 10000);
                }
            }
            
            playAlarmSound(soundType) {
                if (soundType === 'custom' && this.customSounds.length > 0) {
                    // –í–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º —Å–ª—É—á–∞–π–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∑–≤—É–∫
                    const randomIndex = Math.floor(Math.random() * this.customSounds.length);
                    const sound = this.customSounds[randomIndex];
                    const audio = new Audio(sound.data);
                    audio.play().catch(e => console.log("–û—à–∏–±–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –∑–≤—É–∫–∞:", e));
                } else {
                    // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—ã–ª–∏ –±—ã —Ä–∞–∑–Ω—ã–µ –∑–≤—É–∫–æ–≤—ã–µ —Ñ–∞–π–ª—ã
                    try {
                        const audio = new Audio();
                        // –ò—Å–ø–æ–ª—å–∑—É–µ–º –±–∞–∑–æ–≤—É—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –±–µ–∑ –≤–Ω–µ—à–Ω–∏—Ö —Ñ–∞–π–ª–æ–≤
                        console.log(`–í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∑–≤—É–∫–∞: ${soundType}`);
                    } catch(e) {
                        console.log("–û—à–∏–±–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –∑–≤—É–∫–∞:", e);
                    }
                }
            }
            
            // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
            startTimeUpdates() {
                this.updateCurrentTime();
                this.currentTimeInterval = setInterval(() => {
                    this.updateCurrentTime();
                }, 1000);
            }
            
            updateCurrentTime() {
                const now = new Date();
                const timeString = now.toTimeString().substring(0, 8);
                this.elements.currentTime.textContent = timeString;
            }
            
            startAlarmChecks() {
                setInterval(() => {
                    this.checkTimeAlarms();
                }, 1000);
            }
            
            createDemoAlarm() {
                setTimeout(() => {
                    if (this.alarms.length === 0) {
                        const demoLatLng = this.map.getCenter();
                        demoLatLng.lat += 0.005;
                        demoLatLng.lng += 0.005;
                        
                        this.createLocationAlarm(
                            demoLatLng, 
                            "–ü—Ä–∏–º–µ—Ä –≥–µ–æ—Å–∏–≥–Ω–∞–ª–∞", 
                            "–í—ã –¥–æ—Å—Ç–∏–≥–ª–∏ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ —Å–∏–≥–Ω–∞–ª–∞!", 
                            300, 
                            "standard",
                            true
                        );
                    }
                }, 2000);
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ DOM
        document.addEventListener('DOMContentLoaded', () => {
            new SmartAlarm();
        });
    </script>
</body>
</html>