<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–£–º–Ω—ã–π –±—É–¥–∏–ª—å–Ω–∏–∫ | –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è + –í—Ä–µ–º—è</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <!-- PWA –º–µ—Ç–∞—Ç–µ–≥–∏ -->
    <meta name="theme-color" content="#4A6FA5">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="manifest" href="manifest.json">
    <style>
        :root {
            --primary: #4A6FA5;
            --secondary: #2E5077;
            --accent: #FF6B6B;
            --dark: #1A2D42;
            --light: #F5F7FA;
            --success: #4ECDC4;
            --warning: #FFD166;
            --background: linear-gradient(135deg, #1A2D42 0%, #0F1A2B 100%);
            --text-color: #F5F7FA;
            --card-bg: rgba(26, 45, 66, 0.7);
            --input-bg: rgba(245, 247, 250, 0.1);
        }
        
        [data-theme="light"] {
            --primary: #4A6FA5;
            --secondary: #2E5077;
            --accent: #FF6B6B;
            --dark: #FFFFFF;
            --light: #333333;
            --success: #4ECDC4;
            --warning: #FFD166;
            --background: linear-gradient(135deg, #F5F7FA 0%, #E0E5EC 100%);
            --text-color: #333333;
            --card-bg: rgba(255, 255, 255, 0.8);
            --input-bg: rgba(51, 51, 51, 0.1);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Montserrat', 'Segoe UI', sans-serif;
        }
        
        body {
            background: var(--background);
            color: var(--text-color);
            min-height: 100vh;
            overflow-x: hidden;
            padding: 10px;
            transition: all 0.3s ease;
        }
        
        .container {
            max-width: 100%;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        header {
            text-align: center;
            padding: 20px 15px;
            background: var(--card-bg);
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(74, 111, 165, 0.2);
            position: relative;
            overflow: hidden;
        }
        
        header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--accent), var(--success));
        }
        
        h1 {
            font-size: 1.8rem;
            margin-bottom: 10px;
            background: linear-gradient(90deg, var(--primary), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
            letter-spacing: 0.5px;
        }
        
        .tagline {
            font-size: 1rem;
            max-width: 100%;
            margin: 0 auto;
            color: var(--text-color);
            opacity: 0.8;
            line-height: 1.5;
        }
        
        .header-controls {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
        }
        
        .header-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--primary);
            border: none;
            color: white;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.3);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .header-btn:active {
            transform: scale(0.95);
        }
        
        .tabs {
            display: flex;
            background: var(--card-bg);
            border-radius: 12px;
            padding: 3px;
            margin-bottom: 15px;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        .tab {
            flex: 1;
            padding: 12px 8px;
            text-align: center;
            background: transparent;
            border: none;
            color: var(--text-color);
            font-weight: bold;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            min-width: 140px;
        }
        
        .tab.active {
            background: var(--primary);
            box-shadow: 0 3px 10px rgba(74, 111, 165, 0.4);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .map-container {
            width: 100%;
            height: 300px;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.4);
            position: relative;
            border: 1px solid rgba(74, 111, 165, 0.3);
        }
        
        #map {
            height: 100%;
            width: 100%;
            border-radius: 15px;
        }
        
        .map-overlay {
            position: absolute;
            top: 10px;
            right: 10px;
            background: var(--card-bg);
            padding: 8px 15px;
            border-radius: 50px;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 8px;
            backdrop-filter: blur(5px);
            border: 1px solid var(--primary);
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            font-size: 0.9rem;
        }
        
        .location-controls {
            position: absolute;
            bottom: 15px;
            right: 10px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 1000;
        }
        
        .location-btn {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: var(--primary);
            border: none;
            color: white;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.3);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .location-btn:active {
            transform: scale(0.95);
        }
        
        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: var(--success);
            animation: pulse 2s infinite;
        }
        
        .controls {
            width: 100%;
            background: var(--card-bg);
            padding: 20px 15px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(74, 111, 165, 0.2);
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .control-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .section-title {
            font-size: 1.1rem;
            margin-bottom: 5px;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .section-title::before {
            content: '';
            width: 4px;
            height: 16px;
            background: var(--accent);
            border-radius: 2px;
        }
        
        label {
            font-weight: bold;
            font-size: 0.95rem;
            color: var(--text-color);
            opacity: 0.9;
        }
        
        input, select, textarea, button {
            padding: 14px 16px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            background: var(--input-bg);
            color: var(--text-color);
            border: 1px solid rgba(74, 111, 165, 0.3);
            transition: all 0.3s ease;
            width: 100%;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(74, 111, 165, 0.2);
        }
        
        input::placeholder, textarea::placeholder {
            color: var(--text-color);
            opacity: 0.5;
        }
        
        .range-container {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .range-value {
            min-width: 50px;
            text-align: center;
            font-weight: bold;
            background: var(--primary);
            padding: 5px 8px;
            border-radius: 6px;
            font-size: 0.9rem;
            color: white;
        }
        
        button {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 8px;
            position: relative;
            overflow: hidden;
            font-size: 1rem;
            letter-spacing: 0.5px;
            padding: 16px;
        }
        
        button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: 0.5s;
        }
        
        button:hover::before {
            left: 100%;
        }
        
        button:active {
            transform: translateY(2px);
        }
        
        button:disabled {
            background: var(--input-bg);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
            color: var(--text-color);
            opacity: 0.5;
        }
        
        button:disabled::before {
            display: none;
        }
        
        .status-panel {
            padding: 15px;
            border-radius: 10px;
            background: rgba(0, 0, 0, 0.3);
            margin-top: 8px;
            border-left: 3px solid var(--primary);
            font-size: 0.9rem;
        }
        
        .alarm-active {
            animation: alarm-pulse 1.5s infinite;
            border-left-color: var(--accent);
            background: rgba(255, 107, 107, 0.2);
        }
        
        .distance-info {
            font-size: 1.2rem;
            font-weight: bold;
            text-align: center;
            padding: 12px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            border: 1px solid rgba(74, 111, 165, 0.3);
            margin: 8px 0;
            position: relative;
            overflow: hidden;
        }
        
        .distance-info::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(74, 111, 165, 0.1), transparent);
            transform: translateX(-100%);
        }
        
        .distance-info.active::before {
            animation: shimmer 3s infinite;
        }
        
        .alarms-list {
            max-height: 200px;
            overflow-y: auto;
            padding: 8px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .alarm-item {
            padding: 10px 12px;
            background: rgba(74, 111, 165, 0.1);
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid rgba(74, 111, 165, 0.3);
        }
        
        .alarm-name {
            font-weight: bold;
            font-size: 0.95rem;
        }
        
        .alarm-details {
            font-size: 0.8rem;
            color: var(--text-color);
            opacity: 0.7;
        }
        
        .active-alarm {
            background: rgba(78, 205, 196, 0.15);
            border-color: rgba(78, 205, 196, 0.5);
        }
        
        footer {
            text-align: center;
            padding: 15px;
            margin-top: 15px;
            font-size: 0.8rem;
            opacity: 0.7;
            border-top: 1px solid rgba(74, 111, 165, 0.2);
        }
        
        .current-time {
            font-size: 1.3rem;
            text-align: center;
            padding: 12px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            margin: 8px 0;
            font-weight: bold;
        }
        
        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        .action-buttons button {
            flex: 1;
        }
        
        .user-location-marker {
            background: var(--accent);
            border: 3px solid white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            box-shadow: 0 0 10px var(--accent);
            animation: pulse 2s infinite;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –±—É–¥–∏–ª—å–Ω–∏–∫–∞ */
        .alarm-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .alarm-modal.active {
            opacity: 1;
            visibility: visible;
        }
        
        .alarm-modal-content {
            background: var(--dark);
            width: 90%;
            max-width: 400px;
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            border: 2px solid var(--primary);
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }
        
        .alarm-modal.active .alarm-modal-content {
            transform: scale(1);
        }
        
        .alarm-modal-header {
            margin-bottom: 20px;
        }
        
        .alarm-modal-title {
            font-size: 1.8rem;
            color: var(--accent);
            margin-bottom: 10px;
        }
        
        .alarm-modal-message {
            font-size: 1.2rem;
            color: var(--light);
            margin-bottom: 5px;
        }
        
        .alarm-modal-name {
            font-size: 1rem;
            color: rgba(245, 247, 250, 0.7);
            margin-bottom: 20px;
        }
        
        .math-problem {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            font-size: 1.3rem;
            font-weight: bold;
        }
        
        .math-input {
            font-size: 1.2rem;
            text-align: center;
            margin: 10px 0;
        }
        
        .alarm-modal-buttons {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 25px;
        }
        
        .alarm-modal-btn {
            padding: 16px;
            border: none;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .alarm-snooze-btn {
            background: var(--primary);
            color: white;
        }
        
        .alarm-snooze-btn:active {
            background: var(--secondary);
        }
        
        .alarm-dismiss-btn {
            background: var(--accent);
            color: white;
        }
        
        .alarm-dismiss-btn:active {
            background: #e05555;
        }
        
        .alarm-sound-control {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
            padding: 15px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 12px;
        }
        
        .sound-toggle {
            width: 60px;
            height: 34px;
            background: rgba(245, 247, 250, 0.2);
            border-radius: 17px;
            position: relative;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .sound-toggle.active {
            background: var(--success);
        }
        
        .sound-toggle-knob {
            position: absolute;
            top: 2px;
            left: 2px;
            width: 30px;
            height: 30px;
            background: white;
            border-radius: 50%;
            transition: all 0.3s ease;
        }
        
        .sound-toggle.active .sound-toggle-knob {
            left: 28px;
        }
        
        .sound-toggle-label {
            font-weight: bold;
            font-size: 1rem;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∑–≤—É–∫–æ–≤ */
        .custom-sounds-section {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            padding: 15px;
            margin-top: 10px;
        }
        
        .custom-sounds-list {
            max-height: 150px;
            overflow-y: auto;
            margin: 10px 0;
        }
        
        .custom-sound-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 10px;
            background: rgba(74, 111, 165, 0.1);
            border-radius: 8px;
            margin-bottom: 8px;
        }
        
        .sound-name {
            font-size: 0.9rem;
        }
        
        .sound-controls {
            display: flex;
            gap: 5px;
        }
        
        .sound-btn {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: var(--primary);
            border: none;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 0.8rem;
        }
        
        .file-upload-container {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        .file-upload-label {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 12px;
            background: rgba(74, 111, 165, 0.2);
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            text-align: center;
        }
        
        #audioUpload {
            display: none;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ */
        .settings-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .settings-modal.active {
            opacity: 1;
            visibility: visible;
        }
        
        .settings-modal-content {
            background: var(--dark);
            width: 90%;
            max-width: 500px;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            border: 2px solid var(--primary);
            transform: scale(0.9);
            transition: transform 0.3s ease;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .settings-modal.active .settings-modal-content {
            transform: scale(1);
        }
        
        .settings-modal-header {
            margin-bottom: 20px;
            text-align: center;
        }
        
        .settings-modal-title {
            font-size: 1.8rem;
            color: var(--primary);
            margin-bottom: 10px;
        }
        
        .settings-section {
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(74, 111, 165, 0.3);
        }
        
        .settings-section-title {
            font-size: 1.3rem;
            color: var(--accent);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .theme-options {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }
        
        .theme-option {
            flex: 1;
            min-width: 100px;
            padding: 15px;
            border-radius: 10px;
            cursor: pointer;
            text-align: center;
            font-weight: bold;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }
        
        .theme-option.active {
            border-color: var(--accent);
            transform: scale(1.05);
        }
        
        .theme-option.blue {
            background: linear-gradient(135deg, #4A6FA5, #2E5077);
            color: white;
        }
        
        .theme-option.green {
            background: linear-gradient(135deg, #2E7D32, #1B5E20);
            color: white;
        }
        
        .theme-option.purple {
            background: linear-gradient(135deg, #7E57C2, #5E35B1);
            color: white;
        }
        
        .theme-option.dark {
            background: linear-gradient(135deg, #37474F, #263238);
            color: white;
        }
        
        .theme-option.orange {
            background: linear-gradient(135deg, #FF9800, #F57C00);
            color: white;
        }
        
        .theme-option.black {
            background: linear-gradient(135deg, #000000, #333333);
            color: white;
        }
        
        .theme-option.white {
            background: linear-gradient(135deg, #FFFFFF, #E0E0E0);
            color: #333333;
        }
        
        .theme-option.red {
            background: linear-gradient(135deg, #D32F2F, #B71C1C);
            color: white;
        }
        
        .settings-option {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding: 10px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
        }
        
        .settings-label {
            font-weight: bold;
        }
        
        .settings-value {
            color: rgba(245, 247, 250, 0.7);
        }
        
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }
        
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(245, 247, 250, 0.2);
            transition: .4s;
            border-radius: 24px;
        }
        
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .toggle-slider {
            background-color: var(--success);
        }
        
        input:checked + .toggle-slider:before {
            transform: translateX(26px);
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–æ–Ω—Ç–∞–∫—Ç–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ */
        .contacts-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 10px;
        }
        
        .contact-card {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            border-left: 4px solid var(--primary);
        }
        
        .contact-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 10px;
        }
        
        .contact-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }
        
        .contact-title {
            font-size: 1.3rem;
            font-weight: bold;
            color: var(--primary);
        }
        
        .contact-info {
            font-size: 1rem;
            line-height: 1.5;
        }
        
        .contact-link {
            color: var(--accent);
            text-decoration: none;
            transition: all 0.3s ease;
        }
        
        .contact-link:hover {
            text-decoration: underline;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }
        
        @keyframes alarm-pulse {
            0% { box-shadow: 0 0 0 0 rgba(255, 107, 107, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(255, 107, 107, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 107, 107, 0); }
        }
        
        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        
        /* –£–ª—É—á—à–µ–Ω–∏—è –¥–ª—è –æ—á–µ–Ω—å –º–∞–ª–µ–Ω—å–∫–∏—Ö —ç–∫—Ä–∞–Ω–æ–≤ */
        @media (max-width: 360px) {
            h1 {
                font-size: 1.5rem;
            }
            
            .tab {
                font-size: 0.8rem;
                min-width: 120px;
                padding: 10px 6px;
            }
            
            .map-overlay {
                font-size: 0.8rem;
                padding: 6px 12px;
            }
            
            input, select, textarea, button {
                padding: 12px 14px;
            }
            
            .alarm-modal-content {
                padding: 20px;
            }
            
            .alarm-modal-title {
                font-size: 1.5rem;
            }
            
            .header-controls {
                top: 15px;
                right: 15px;
            }
            
            .header-btn {
                width: 35px;
                height: 35px;
                font-size: 1rem;
            }
        }
        
        /* –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–∞—è –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏—è */
        @media (min-width: 768px) and (max-height: 500px) {
            .container {
                max-width: 100%;
            }
            
            .map-container {
                height: 400px;
            }
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ PWA */
        .install-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            font-size: 1.5rem;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            cursor: pointer;
            z-index: 1000;
            display: none;
            align-items: center;
            justify-content: center;
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- –ö–Ω–æ–ø–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ PWA -->
    <button class="install-btn" id="installBtn" title="–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ">üì±</button>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –±—É–¥–∏–ª—å–Ω–∏–∫–∞ -->
    <div class="alarm-modal" id="alarmModal">
        <div class="alarm-modal-content">
            <div class="alarm-modal-header">
                <h2 class="alarm-modal-title">–ë–£–î–ò–õ–¨–ù–ò–ö</h2>
                <p class="alarm-modal-message" id="modalMessage">–°–æ–æ–±—â–µ–Ω–∏–µ –±—É–¥–∏–ª—å–Ω–∏–∫–∞</p>
                <p class="alarm-modal-name" id="modalName">–ù–∞–∑–≤–∞–Ω–∏–µ –±—É–¥–∏–ª—å–Ω–∏–∫–∞</p>
            </div>
            
            <div class="math-problem" id="mathProblem" style="display: none;">
                –†–µ—à–∏—Ç–µ –ø—Ä–∏–º–µ—Ä: <span id="mathExpression">5 + 3</span>
                <input type="number" class="math-input" id="mathAnswer" placeholder="–û—Ç–≤–µ—Ç">
                <button id="checkMathAnswer">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
            </div>
            
            <div class="alarm-sound-control">
                <span class="sound-toggle-label">–ó–≤—É–∫</span>
                <div class="sound-toggle active" id="soundToggle">
                    <div class="sound-toggle-knob"></div>
                </div>
            </div>
            
            <div class="alarm-modal-buttons">
                <button class="alarm-modal-btn alarm-snooze-btn" id="snoozeBtn">–û—Ç–ª–æ–∂–∏—Ç—å (5 –º–∏–Ω)</button>
                <button class="alarm-modal-btn alarm-dismiss-btn" id="dismissBtn" disabled>–û—Ç–∫–ª—é—á–∏—Ç—å</button>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–∫ -->
    <div class="settings-modal" id="settingsModal">
        <div class="settings-modal-content">
            <div class="settings-modal-header">
                <h2 class="settings-modal-title">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
            </div>
            
            <div class="settings-section">
                <h3 class="settings-section-title">üé® –¶–≤–µ—Ç–æ–≤–∞—è —Ç–µ–º–∞</h3>
                <div class="theme-options">
                    <div class="theme-option blue active" data-theme="blue">
                        –°–∏–Ω—è—è
                    </div>
                    <div class="theme-option green" data-theme="green">
                        –ó–µ–ª–µ–Ω–∞—è
                    </div>
                    <div class="theme-option purple" data-theme="purple">
                        –§–∏–æ–ª–µ—Ç–æ–≤–∞—è
                    </div>
                    <div class="theme-option dark" data-theme="dark">
                        –¢–µ–º–Ω–∞—è
                    </div>
                    <div class="theme-option orange" data-theme="orange">
                        –û—Ä–∞–Ω–∂–µ–≤–∞—è
                    </div>
                    <div class="theme-option black" data-theme="black">
                        –ß–µ—Ä–Ω–∞—è
                    </div>
                    <div class="theme-option white" data-theme="white">
                        –ë–µ–ª–∞—è
                    </div>
                    <div class="theme-option red" data-theme="red">
                        –ö—Ä–∞—Å–Ω–∞—è
                    </div>
                </div>
            </div>
            
            <div class="settings-section">
                <h3 class="settings-section-title">üîä –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∑–≤—É–∫–∞</h3>
                <div class="settings-option">
                    <span class="settings-label">–ì—Ä–æ–º–∫–æ—Å—Ç—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é</span>
                    <div class="range-container">
                        <input type="range" id="defaultVolume" min="0" max="100" value="80">
                        <div class="range-value" id="volumeValue">80%</div>
                    </div>
                </div>
                <div class="settings-option">
                    <span class="settings-label">–ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–µ —É–≤–µ–ª–∏—á–µ–Ω–∏–µ –≥—Ä–æ–º–∫–æ—Å—Ç–∏</span>
                    <label class="toggle-switch">
                        <input type="checkbox" id="fadeInVolume">
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="settings-option">
                    <span class="settings-label">–í–∏–±—Ä–∞—Ü–∏—è</span>
                    <label class="toggle-switch">
                        <input type="checkbox" id="vibrationSetting" checked>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
            </div>
            
            <div class="settings-section">
                <h3 class="settings-section-title">üìç –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏</h3>
                <div class="settings-option">
                    <span class="settings-label">–í—ã—Å–æ–∫–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å</span>
                    <label class="toggle-switch">
                        <input type="checkbox" id="highAccuracy" checked>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="settings-option">
                    <span class="settings-label">–ê–≤—Ç–æ-—Å–ª–µ–∂–µ–Ω–∏–µ</span>
                    <label class="toggle-switch">
                        <input type="checkbox" id="autoTracking">
                        <span class="toggle-slider"></span>
                    </label>
                </div>
            </div>
            
            <div class="settings-section">
                <h3 class="settings-section-title">‚è∞ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –±—É–¥–∏–ª—å–Ω–∏–∫–æ–≤</h3>
                <div class="settings-option">
                    <span class="settings-label">–ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞–Ω–∏—è</span>
                    <label class="toggle-switch">
                        <input type="checkbox" id="mathProblems">
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="settings-option">
                    <span class="settings-label">–ü–æ–≤—Ç–æ—Ä —Å–∏–≥–Ω–∞–ª–∞</span>
                    <label class="toggle-switch">
                        <input type="checkbox" id="repeatAlarm" checked>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="settings-option">
                    <span class="settings-label">–ê–≤—Ç–æ-—É–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö</span>
                    <label class="toggle-switch">
                        <input type="checkbox" id="autoDelete">
                        <span class="toggle-slider"></span>
                    </label>
                </div>
            </div>
            
            <div class="action-buttons">
                <button id="saveSettingsBtn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</button>
                <button id="closeSettingsBtn" style="background: rgba(245, 247, 250, 0.1);">–ó–∞–∫—Ä—ã—Ç—å</button>
            </div>
        </div>
    </div>

    <div class="container">
        <header>
            <h1>–£–ú–ù–´–ô –ë–£–î–ò–õ–¨–ù–ò–ö</h1>
            <p class="tagline">–°–∏–≥–Ω–∞–ª—ã –ø–æ –≤—Ä–µ–º–µ–Ω–∏ –∏ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—é</p>
            
            <div class="header-controls">
                <button class="header-btn" id="themeBtn" title="–°–º–µ–Ω–∏—Ç—å —Ç–µ–º—É">üé®</button>
                <button class="header-btn" id="contactsBtn" title="–ö–æ–Ω—Ç–∞–∫—Ç—ã">üìû</button>
                <button class="header-btn" id="settingsBtn" title="–ù–∞—Å—Ç—Ä–æ–π–∫–∏">‚öôÔ∏è</button>
            </div>
        </header>
        
        <div class="tabs">
            <button class="tab active" data-tab="location">–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è</button>
            <button class="tab" data-tab="time">–ü–æ –≤—Ä–µ–º–µ–Ω–∏</button>
            <button class="tab" data-tab="sounds">–ú–æ–∏ –∑–≤—É–∫–∏</button>
            <button class="tab" data-tab="contacts">–ö–æ–Ω—Ç–∞–∫—Ç—ã</button>
        </div>
        
        <div class="map-container">
            <div id="map"></div>
            <div class="map-overlay">
                <div class="status-dot"></div>
                <span>–°–∏–≥–Ω–∞–ª–æ–≤: <span id="activeAlarmsCount">0</span></span>
            </div>
            <div class="location-controls">
                <button class="location-btn" id="locateUser" title="–ù–∞–π—Ç–∏ –º–µ–Ω—è">üìç</button>
                <button class="location-btn" id="trackUser" title="–°–ª–µ–¥–∏—Ç—å –∑–∞ –º–Ω–æ–π">üëÅÔ∏è</button>
            </div>
        </div>
        
        <div class="controls">
            <div class="tab-content active" id="location-tab">
                <div class="control-group">
                    <div class="section-title">–ì–µ–æ–ª–æ–∫–∞—Ü–∏–æ–Ω–Ω—ã–π —Å–∏–≥–Ω–∞–ª</div>
                    
                    <label for="alarmName">–ù–∞–∑–≤–∞–Ω–∏–µ:</label>
                    <input type="text" id="alarmName" placeholder="–†–∞–±–æ—Ç–∞, –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞...">
                    
                    <label for="alarmRadius">–†–∞–¥–∏—É—Å (–º–µ—Ç—Ä—ã):</label>
                    <div class="range-container">
                        <input type="range" id="alarmRadius" min="50" max="2000" value="300">
                        <div class="range-value" id="radiusValue">300 –º</div>
                    </div>
                    
                    <label for="alarmSound">–ó–≤—É–∫ —Å–∏–≥–Ω–∞–ª–∞:</label>
                    <select id="alarmSound">
                        <option value="standard">–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Å–∏–≥–Ω–∞–ª</option>
                        <option value="melodic">–ú–µ–ª–æ–¥–∏—á–Ω—ã–π –∑–≤–æ–Ω</option>
                        <option value="custom">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∑–≤—É–∫</option>
                    </select>
                    
                    <div id="customSoundSelection" style="display: none;">
                        <label for="selectedCustomSound">–í—ã–±–µ—Ä–∏—Ç–µ –∑–≤—É–∫:</label>
                        <select id="selectedCustomSound">
                            <!-- –ó–∞–ø–æ–ª–Ω–∏—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                        </select>
                    </div>
                    
                    <label for="alarmMessage">–°–æ–æ–±—â–µ–Ω–∏–µ:</label>
                    <textarea id="alarmMessage" placeholder="–¢–µ–∫—Å—Ç –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è..." rows="2"></textarea>
                    
                    <button id="createAlarmBtn">–°–æ–∑–¥–∞—Ç—å –≥–µ–æ—Å–∏–≥–Ω–∞–ª</button>
                </div>
            </div>
            
            <div class="tab-content" id="time-tab">
                <div class="control-group">
                    <div class="section-title">–í—Ä–µ–º–µ–Ω–Ω–æ–π –±—É–¥–∏–ª—å–Ω–∏–∫</div>
                    
                    <label for="timeAlarmName">–ù–∞–∑–≤–∞–Ω–∏–µ:</label>
                    <input type="text" id="timeAlarmName" placeholder="–ü–æ–¥—ä–µ–º, –û–±–µ–¥...">
                    
                    <label for="alarmTime">–í—Ä–µ–º—è:</label>
                    <input type="time" id="alarmTime">
                    
                    <label for="repeatDays">–ü–æ–≤—Ç–æ—Ä:</label>
                    <select id="repeatDays">
                        <option value="once">–û–¥–∏–Ω —Ä–∞–∑</option>
                        <option value="daily">–ï–∂–µ–¥–Ω–µ–≤–Ω–æ</option>
                        <option value="weekdays">–ü–æ –±—É–¥–Ω—è–º</option>
                        <option value="weekends">–ü–æ –≤—ã—Ö–æ–¥–Ω—ã–º</option>
                    </select>
                    
                    <label for="timeAlarmSound">–ó–≤—É–∫ —Å–∏–≥–Ω–∞–ª–∞:</label>
                    <select id="timeAlarmSound">
                        <option value="standard">–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Å–∏–≥–Ω–∞–ª</option>
                        <option value="melodic">–ú–µ–ª–æ–¥–∏—á–Ω—ã–π –∑–≤–æ–Ω</option>
                        <option value="custom">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∑–≤—É–∫</option>
                    </select>
                    
                    <div id="timeCustomSoundSelection" style="display: none;">
                        <label for="timeSelectedCustomSound">–í—ã–±–µ—Ä–∏—Ç–µ –∑–≤—É–∫:</label>
                        <select id="timeSelectedCustomSound">
                            <!-- –ó–∞–ø–æ–ª–Ω–∏—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                        </select>
                    </div>
                    
                    <label for="timeAlarmMessage">–°–æ–æ–±—â–µ–Ω–∏–µ:</label>
                    <textarea id="timeAlarmMessage" placeholder="–¢–µ–∫—Å—Ç –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è..." rows="2"></textarea>
                    
                    <button id="createTimeAlarmBtn">–°–æ–∑–¥–∞—Ç—å –±—É–¥–∏–ª—å–Ω–∏–∫</button>
                </div>
            </div>
            
            <div class="tab-content" id="sounds-tab">
                <div class="control-group">
                    <div class="section-title">–ó–∞–≥—Ä—É–∑–∫–∞ –∑–≤—É–∫–æ–≤</div>
                    
                    <p>–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Å–≤–æ–∏ –∑–≤—É–∫–∏ –¥–ª—è –±—É–¥–∏–ª—å–Ω–∏–∫–æ–≤ (MP3, WAV, OGG)</p>
                    
                    <div class="file-upload-container">
                        <label for="audioUpload" class="file-upload-label">
                            üìÅ –í—ã–±—Ä–∞—Ç—å –∑–≤—É–∫–æ–≤–æ–π —Ñ–∞–π–ª
                        </label>
                        <input type="file" id="audioUpload" accept="audio/*">
                        <button id="uploadSoundBtn">–ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
                    </div>
                    
                    <div class="custom-sounds-section">
                        <div class="section-title">–ú–æ–∏ –∑–≤—É–∫–∏</div>
                        <div class="custom-sounds-list" id="customSoundsList">
                            <div class="custom-sound-item">
                                <span class="sound-name">–ü–æ–∫–∞ –Ω–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –∑–≤—É–∫–æ–≤</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="tab-content" id="contacts-tab">
                <div class="control-group">
                    <div class="section-title">–ö–æ–Ω—Ç–∞–∫—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</div>
                    
                    <div class="contacts-container">
                        <div class="contact-card">
                            <div class="contact-header">
                                <div class="contact-icon">üë§</div>
                                <div class="contact-title">–§–ò–û</div>
                            </div>
                            <div class="contact-info">
                                <p>–ú–∏—Ö–µ–π–∫–∏–Ω –ò–ª—å—è –ê–ª–µ–∫—Å–µ–µ–≤–∏—á</p>
                                <p>–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è "–£–º–Ω—ã–π –±—É–¥–∏–ª—å–Ω–∏–∫"</p>
                            </div>
                        </div>
                        
                        <div class="contact-card">
                            <div class="contact-header">
                                <div class="contact-icon">üìß</div>
                                <div class="contact-title">–≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è –ø–æ—á—Ç–∞</div>
                            </div>
                            <div class="contact-info">
                                <p>–ü–æ –≤—Å–µ–º –≤–æ–ø—Ä–æ—Å–∞–º –∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è–º –æ–±—Ä–∞—â–∞–π—Ç–µ—Å—å –ø–æ email:</p>
                                <p><a href="mailto:mihilia28@gmail.com" class="contact-link">mihilia28@gmail.com</a></p>
                            </div>
                        </div>
                        
                        <div class="contact-card">
                            <div class="contact-header">
                                <div class="contact-icon">üåê</div>
                                <div class="contact-title">–í–µ–±-—Å–∞–π—Ç</div>
                            </div>
                            <div class="contact-info">
                                <p>–ü–æ—Å–µ—Ç–∏—Ç–µ –Ω–∞—à –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π —Å–∞–π—Ç –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏:</p>
                                <p><a href="https://zzerroxx1.github.io/smarkasd/" class="contact-link" target="_blank">smart-alarm.ru</a></p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="control-group">
                <div class="section-title">–¢–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è</div>
                <div class="current-time" id="currentTime">--:--:--</div>
            </div>
            
            <div class="control-group">
                <div class="section-title">–ú–æ–∏ —Å–∏–≥–Ω–∞–ª—ã</div>
                <div class="alarms-list" id="alarmsList">
                    <div class="alarm-item">
                        <span class="alarm-name">–ü–æ–∫–∞ –Ω–µ—Ç —Å–∏–≥–Ω–∞–ª–æ–≤</span>
                    </div>
                </div>
            </div>
            
            <div class="control-group">
                <div class="section-title">–ù–∞–≤–∏–≥–∞—Ü–∏—è</div>
                
                <label>–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:</label>
                <div class="status-panel" id="locationStatus">–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è...</div>
                
                <label>–†–∞—Å—Å—Ç–æ—è–Ω–∏–µ –¥–æ —Ü–µ–ª–∏:</label>
                <div class="distance-info" id="distanceInfo">-</div>
                
                <label>–°—Ç–∞—Ç—É—Å:</label>
                <div class="status-panel" id="alarmStatus">–°–∏—Å—Ç–µ–º–∞ –∞–∫—Ç–∏–≤–Ω–∞</div>
                
                <div class="action-buttons">
                    <button id="clearAlarmsBtn">–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ</button>
                    <button id="testAlarmBtn">–¢–µ—Å—Ç —Å–∏–≥–Ω–∞–ª–∞</button>
                </div>
            </div>
        </div>
        
        <footer>
            <p>–£–º–Ω—ã–π –±—É–¥–∏–ª—å–Ω–∏–∫ &copy; 2025</p>
        </footer>
    </div>

    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ä—Ç—ã
        const map = L.map('map').setView([55.7558, 37.6173], 13);
        
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);
        
        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
        let userMarker = null;
        let userAccuracyCircle = null;
        let alarms = [];
        let customSounds = [];
        let watchId = null;
        let closestAlarm = null;
        let currentTimeInterval = null;
        let isTracking = false;
        let activeAlarmModal = null;
        let alarmAudio = null;
        let selectedFile = null;
        let currentTheme = 'blue';
        let fadeInInterval = null;
        let mathAnswerCorrect = false;
        let deferredPrompt = null;
        
        // –≠–ª–µ–º–µ–Ω—Ç—ã DOM
        const locationStatus = document.getElementById('locationStatus');
        const distanceInfo = document.getElementById('distanceInfo');
        const alarmStatus = document.getElementById('alarmStatus');
        const createAlarmBtn = document.getElementById('createAlarmBtn');
        const createTimeAlarmBtn = document.getElementById('createTimeAlarmBtn');
        const clearAlarmsBtn = document.getElementById('clearAlarmsBtn');
        const testAlarmBtn = document.getElementById('testAlarmBtn');
        const locateUserBtn = document.getElementById('locateUser');
        const trackUserBtn = document.getElementById('trackUser');
        const uploadSoundBtn = document.getElementById('uploadSoundBtn');
        const audioUpload = document.getElementById('audioUpload');
        const alarmRadius = document.getElementById('alarmRadius');
        const radiusValue = document.getElementById('radiusValue');
        const alarmsList = document.getElementById('alarmsList');
        const customSoundsList = document.getElementById('customSoundsList');
        const activeAlarmsCount = document.getElementById('activeAlarmsCount');
        const currentTime = document.getElementById('currentTime');
        const tabs = document.querySelectorAll('.tab');
        const tabContents = document.querySelectorAll('.tab-content');
        const alarmSound = document.getElementById('alarmSound');
        const timeAlarmSound = document.getElementById('timeAlarmSound');
        const customSoundSelection = document.getElementById('customSoundSelection');
        const timeCustomSoundSelection = document.getElementById('timeCustomSoundSelection');
        const selectedCustomSound = document.getElementById('selectedCustomSound');
        const timeSelectedCustomSound = document.getElementById('timeSelectedCustomSound');
        const themeBtn = document.getElementById('themeBtn');
        const contactsBtn = document.getElementById('contactsBtn');
        const settingsBtn = document.getElementById('settingsBtn');
        const installBtn = document.getElementById('installBtn');
        
        // –≠–ª–µ–º–µ–Ω—Ç—ã –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –±—É–¥–∏–ª—å–Ω–∏–∫–∞
        const alarmModal = document.getElementById('alarmModal');
        const modalMessage = document.getElementById('modalMessage');
        const modalName = document.getElementById('modalName');
        const mathProblem = document.getElementById('mathProblem');
        const mathExpression = document.getElementById('mathExpression');
        const mathAnswer = document.getElementById('mathAnswer');
        const checkMathAnswer = document.getElementById('checkMathAnswer');
        const soundToggle = document.getElementById('soundToggle');
        const snoozeBtn = document.getElementById('snoozeBtn');
        const dismissBtn = document.getElementById('dismissBtn');
        
        // –≠–ª–µ–º–µ–Ω—Ç—ã –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫
        const settingsModal = document.getElementById('settingsModal');
        const themeOptions = document.querySelectorAll('.theme-option');
        const defaultVolume = document.getElementById('defaultVolume');
        const volumeValue = document.getElementById('volumeValue');
        const fadeInVolume = document.getElementById('fadeInVolume');
        const vibrationSetting = document.getElementById('vibrationSetting');
        const highAccuracy = document.getElementById('highAccuracy');
        const autoTracking = document.getElementById('autoTracking');
        const mathProblems = document.getElementById('mathProblems');
        const repeatAlarm = document.getElementById('repeatAlarm');
        const autoDelete = document.getElementById('autoDelete');
        const saveSettingsBtn = document.getElementById('saveSettingsBtn');
        const closeSettingsBtn = document.getElementById('closeSettingsBtn');
        
        // PWA: –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–±—ã—Ç–∏—è beforeinstallprompt
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            installBtn.style.display = 'flex';
        });
        
        // PWA: –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –ø–æ –∫–Ω–æ–ø–∫–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏
        installBtn.addEventListener('click', async () => {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                if (outcome === 'accepted') {
                    installBtn.style.display = 'none';
                }
                deferredPrompt = null;
            }
        });
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –∑–≤—É–∫–æ–≤ –∏–∑ localStorage
        function loadCustomSounds() {
            const savedSounds = localStorage.getItem('customSounds');
            if (savedSounds) {
                customSounds = JSON.parse(savedSounds);
                updateCustomSoundsList();
                updateCustomSoundSelectors();
            }
        }
        
        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –∑–≤—É–∫–æ–≤ –≤ localStorage
        function saveCustomSounds() {
            localStorage.setItem('customSounds', JSON.stringify(customSounds));
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∏–∑ localStorage
        function loadSettings() {
            const savedSettings = localStorage.getItem('alarmSettings');
            if (savedSettings) {
                const settings = JSON.parse(savedSettings);
                
                // –ü—Ä–∏–º–µ–Ω—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
                if (settings.theme) {
                    applyTheme(settings.theme);
                }
                if (settings.volume !== undefined) {
                    defaultVolume.value = settings.volume;
                    volumeValue.textContent = `${settings.volume}%`;
                }
                if (settings.fadeInVolume !== undefined) {
                    fadeInVolume.checked = settings.fadeInVolume;
                }
                if (settings.vibration !== undefined) {
                    vibrationSetting.checked = settings.vibration;
                }
                if (settings.highAccuracy !== undefined) {
                    highAccuracy.checked = settings.highAccuracy;
                }
                if (settings.autoTracking !== undefined) {
                    autoTracking.checked = settings.autoTracking;
                }
                if (settings.mathProblems !== undefined) {
                    mathProblems.checked = settings.mathProblems;
                }
                if (settings.repeatAlarm !== undefined) {
                    repeatAlarm.checked = settings.repeatAlarm;
                }
                if (settings.autoDelete !== undefined) {
                    autoDelete.checked = settings.autoDelete;
                }
            }
        }
        
        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –≤ localStorage
        function saveSettings() {
            const settings = {
                theme: currentTheme,
                volume: parseInt(defaultVolume.value),
                fadeInVolume: fadeInVolume.checked,
                vibration: vibrationSetting.checked,
                highAccuracy: highAccuracy.checked,
                autoTracking: autoTracking.checked,
                mathProblems: mathProblems.checked,
                repeatAlarm: repeatAlarm.checked,
                autoDelete: autoDelete.checked
            };
            
            localStorage.setItem('alarmSettings', JSON.stringify(settings));
            alert('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!');
        }
        
        // –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Ü–≤–µ—Ç–æ–≤–æ–π —Ç–µ–º—ã
        function applyTheme(theme) {
            currentTheme = theme;
            
            // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —É –≤—Å–µ—Ö —Ç–µ–º
            themeOptions.forEach(option => {
                option.classList.remove('active');
            });
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å –∫ –≤—ã–±—Ä–∞–Ω–Ω–æ–π —Ç–µ–º–µ
            const selectedOption = document.querySelector(`.theme-option.${theme}`);
            if (selectedOption) {
                selectedOption.classList.add('active');
            }
            
            // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ü–≤–µ—Ç–∞ —Ç–µ–º—ã
            const root = document.documentElement;
            const body = document.body;
            
            switch(theme) {
                case 'blue':
                    root.style.setProperty('--primary', '#4A6FA5');
                    root.style.setProperty('--secondary', '#2E5077');
                    root.style.setProperty('--accent', '#FF6B6B');
                    root.style.setProperty('--dark', '#1A2D42');
                    root.style.setProperty('--light', '#F5F7FA');
                    root.style.setProperty('--success', '#4ECDC4');
                    root.style.setProperty('--warning', '#FFD166');
                    root.style.setProperty('--background', 'linear-gradient(135deg, #1A2D42 0%, #0F1A2B 100%)');
                    root.style.setProperty('--text-color', '#F5F7FA');
                    root.style.setProperty('--card-bg', 'rgba(26, 45, 66, 0.7)');
                    root.style.setProperty('--input-bg', 'rgba(245, 247, 250, 0.1)');
                    body.setAttribute('data-theme', 'dark');
                    break;
                    
                case 'green':
                    root.style.setProperty('--primary', '#2E7D32');
                    root.style.setProperty('--secondary', '#1B5E20');
                    root.style.setProperty('--accent', '#FF7043');
                    root.style.setProperty('--dark', '#1B3C1F');
                    root.style.setProperty('--light', '#F1F8E9');
                    root.style.setProperty('--success', '#66BB6A');
                    root.style.setProperty('--warning', '#FFD54F');
                    root.style.setProperty('--background', 'linear-gradient(135deg, #1B3C1F 0%, #0F1F12 100%)');
                    root.style.setProperty('--text-color', '#F1F8E9');
                    root.style.setProperty('--card-bg', 'rgba(27, 60, 31, 0.7)');
                    root.style.setProperty('--input-bg', 'rgba(241, 248, 233, 0.1)');
                    body.setAttribute('data-theme', 'dark');
                    break;
                    
                case 'purple':
                    root.style.setProperty('--primary', '#7E57C2');
                    root.style.setProperty('--secondary', '#5E35B1');
                    root.style.setProperty('--accent', '#FF5252');
                    root.style.setProperty('--dark', '#311B92');
                    root.style.setProperty('--light', '#F3E5F5');
                    root.style.setProperty('--success', '#AB47BC');
                    root.style.setProperty('--warning', '#FFCA28');
                    root.style.setProperty('--background', 'linear-gradient(135deg, #311B92 0%, #1A0F4F 100%)');
                    root.style.setProperty('--text-color', '#F3E5F5');
                    root.style.setProperty('--card-bg', 'rgba(49, 27, 146, 0.7)');
                    root.style.setProperty('--input-bg', 'rgba(243, 229, 245, 0.1)');
                    body.setAttribute('data-theme', 'dark');
                    break;
                    
                case 'dark':
                    root.style.setProperty('--primary', '#37474F');
                    root.style.setProperty('--secondary', '#263238');
                    root.style.setProperty('--accent', '#FF6E40');
                    root.style.setProperty('--dark', '#0D1418');
                    root.style.setProperty('--light', '#ECEFF1');
                    root.style.setProperty('--success', '#26A69A');
                    root.style.setProperty('--warning', '#FFB74D');
                    root.style.setProperty('--background', 'linear-gradient(135deg, #0D1418 0%, #05090C 100%)');
                    root.style.setProperty('--text-color', '#ECEFF1');
                    root.style.setProperty('--card-bg', 'rgba(13, 20, 24, 0.7)');
                    root.style.setProperty('--input-bg', 'rgba(236, 239, 241, 0.1)');
                    body.setAttribute('data-theme', 'dark');
                    break;
                    
                case 'orange':
                    root.style.setProperty('--primary', '#FF9800');
                    root.style.setProperty('--secondary', '#F57C00');
                    root.style.setProperty('--accent', '#E53935');
                    root.style.setProperty('--dark', '#E65100');
                    root.style.setProperty('--light', '#FFF3E0');
                    root.style.setProperty('--success', '#43A047');
                    root.style.setProperty('--warning', '#FFB300');
                    root.style.setProperty('--background', 'linear-gradient(135deg, #E65100 0%, #BF360C 100%)');
                    root.style.setProperty('--text-color', '#FFF3E0');
                    root.style.setProperty('--card-bg', 'rgba(230, 81, 0, 0.7)');
                    root.style.setProperty('--input-bg', 'rgba(255, 243, 224, 0.1)');
                    body.setAttribute('data-theme', 'dark');
                    break;
                    
                case 'black':
                    root.style.setProperty('--primary', '#000000');
                    root.style.setProperty('--secondary', '#333333');
                    root.style.setProperty('--accent', '#FF3333');
                    root.style.setProperty('--dark', '#000000');
                    root.style.setProperty('--light', '#E6E6E6');
                    root.style.setProperty('--success', '#00CC44');
                    root.style.setProperty('--warning', '#FFCC00');
                    root.style.setProperty('--background', 'linear-gradient(135deg, #000000 0%, #1A1A1A 100%)');
                    root.style.setProperty('--text-color', '#E6E6E6');
                    root.style.setProperty('--card-bg', 'rgba(0, 0, 0, 0.7)');
                    root.style.setProperty('--input-bg', 'rgba(230, 230, 230, 0.1)');
                    body.setAttribute('data-theme', 'dark');
                    break;
                    
                case 'white':
                    root.style.setProperty('--primary', '#4A6FA5');
                    root.style.setProperty('--secondary', '#2E5077');
                    root.style.setProperty('--accent', '#FF6B6B');
                    root.style.setProperty('--dark', '#FFFFFF');
                    root.style.setProperty('--light', '#333333');
                    root.style.setProperty('--success', '#4ECDC4');
                    root.style.setProperty('--warning', '#FFD166');
                    root.style.setProperty('--background', 'linear-gradient(135deg, #F5F7FA 0%, #E0E5EC 100%)');
                    root.style.setProperty('--text-color', '#333333');
                    root.style.setProperty('--card-bg', 'rgba(255, 255, 255, 0.8)');
                    root.style.setProperty('--input-bg', 'rgba(51, 51, 51, 0.1)');
                    body.setAttribute('data-theme', 'light');
                    break;
                    
                case 'red':
                    root.style.setProperty('--primary', '#CC0000');
                    root.style.setProperty('--secondary', '#990000');
                    root.style.setProperty('--accent', '#FF6666');
                    root.style.setProperty('--dark', '#330000');
                    root.style.setProperty('--light', '#FFE6E6');
                    root.style.setProperty('--success', '#00CC00');
                    root.style.setProperty('--warning', '#FFCC00');
                    root.style.setProperty('--background', 'linear-gradient(135deg, #330000 0%, #1A0000 100%)');
                    root.style.setProperty('--text-color', '#FFE6E6');
                    root.style.setProperty('--card-bg', 'rgba(51, 0, 0, 0.7)');
                    root.style.setProperty('--input-bg', 'rgba(255, 230, 230, 0.1)');
                    body.setAttribute('data-theme', 'dark');
                    break;
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –∑–≤—É–∫–æ–≤
        function updateCustomSoundsList() {
            customSoundsList.innerHTML = '';
            
            if (customSounds.length === 0) {
                customSoundsList.innerHTML = '<div class="custom-sound-item"><span class="sound-name">–ü–æ–∫–∞ –Ω–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –∑–≤—É–∫–æ–≤</span></div>';
                return;
            }
            
            customSounds.forEach((sound, index) => {
                const soundElement = document.createElement('div');
                soundElement.className = 'custom-sound-item';
                soundElement.innerHTML = `
                    <span class="sound-name">${sound.name}</span>
                    <div class="sound-controls">
                        <button class="sound-btn play-sound" data-index="${index}" title="–í–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏">‚ñ∂Ô∏è</button>
                        <button class="sound-btn delete-sound" data-index="${index}" title="–£–¥–∞–ª–∏—Ç—å">üóëÔ∏è</button>
                    </div>
                `;
                customSoundsList.appendChild(soundElement);
            });
            
            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –∏ —É–¥–∞–ª–µ–Ω–∏—è
            document.querySelectorAll('.play-sound').forEach(button => {
                button.addEventListener('click', function() {
                    const index = parseInt(this.getAttribute('data-index'));
                    playCustomSound(index);
                });
            });
            
            document.querySelectorAll('.delete-sound').forEach(button => {
                button.addEventListener('click', function() {
                    const index = parseInt(this.getAttribute('data-index'));
                    deleteCustomSound(index);
                });
            });
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—ã–ø–∞–¥–∞—é—â–∏—Ö —Å–ø–∏—Å–∫–æ–≤ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–º–∏ –∑–≤—É–∫–∞–º–∏
        function updateCustomSoundSelectors() {
            selectedCustomSound.innerHTML = '';
            timeSelectedCustomSound.innerHTML = '';
            
            if (customSounds.length === 0) {
                selectedCustomSound.innerHTML = '<option value="">–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∑–≤—É–∫–æ–≤</option>';
                timeSelectedCustomSound.innerHTML = '<option value="">–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∑–≤—É–∫–æ–≤</option>';
                return;
            }
            
            customSounds.forEach((sound, index) => {
                const option1 = document.createElement('option');
                option1.value = index;
                option1.textContent = sound.name;
                selectedCustomSound.appendChild(option1);
                
                const option2 = document.createElement('option');
                option2.value = index;
                option2.textContent = sound.name;
                timeSelectedCustomSound.appendChild(option2);
            });
        }
        
        // –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –∑–≤—É–∫–∞
        function playCustomSound(index) {
            if (index >= 0 && index < customSounds.length) {
                const sound = customSounds[index];
                const audio = new Audio(sound.data);
                audio.volume = parseInt(defaultVolume.value) / 100;
                audio.play().catch(e => {
                    console.log("–û—à–∏–±–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –∑–≤—É–∫–∞:", e);
                    alert("–ù–µ —É–¥–∞–ª–æ—Å—å –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏ –∑–≤—É–∫. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞.");
                });
            }
        }
        
        // –£–¥–∞–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –∑–≤—É–∫–∞
        function deleteCustomSound(index) {
            if (index >= 0 && index < customSounds.length) {
                if (confirm(`–£–¥–∞–ª–∏—Ç—å –∑–≤—É–∫ "${customSounds[index].name}"?`)) {
                    customSounds.splice(index, 1);
                    saveCustomSounds();
                    updateCustomSoundsList();
                    updateCustomSoundSelectors();
                }
            }
        }
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–∞
        audioUpload.addEventListener('change', function(e) {
            if (e.target.files.length > 0) {
                selectedFile = e.target.files[0];
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–º—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞
                document.querySelector('.file-upload-label').textContent = `üìÅ ${selectedFile.name}`;
            }
        });
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–≤—É–∫–∞
        uploadSoundBtn.addEventListener('click', function() {
            if (!selectedFile) {
                alert("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –∑–≤—É–∫–æ–≤–æ–π —Ñ–∞–π–ª");
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const soundData = e.target.result;
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ 5MB)
                if (selectedFile.size > 5 * 1024 * 1024) {
                    alert("–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π. –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä - 5MB.");
                    return;
                }
                
                // –î–æ–±–∞–≤–ª—è–µ–º –∑–≤—É–∫ –≤ —Å–ø–∏—Å–æ–∫
                customSounds.push({
                    name: selectedFile.name,
                    data: soundData
                });
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏ –æ–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫
                saveCustomSounds();
                updateCustomSoundsList();
                updateCustomSoundSelectors();
                
                // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—ã–±–æ—Ä —Ñ–∞–π–ª–∞
                selectedFile = null;
                audioUpload.value = '';
                document.querySelector('.file-upload-label').textContent = 'üìÅ –í—ã–±—Ä–∞—Ç—å –∑–≤—É–∫–æ–≤–æ–π —Ñ–∞–π–ª';
                
                alert("–ó–≤—É–∫ —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω!");
            };
            
            reader.readAsDataURL(selectedFile);
        });
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ç–∏–ø–∞ –∑–≤—É–∫–∞
        alarmSound.addEventListener('change', function() {
            if (this.value === 'custom') {
                customSoundSelection.style.display = 'block';
            } else {
                customSoundSelection.style.display = 'none';
            }
        });
        
        timeAlarmSound.addEventListener('change', function() {
            if (this.value === 'custom') {
                timeCustomSoundSelection.style.display = 'block';
            } else {
                timeCustomSoundSelection.style.display = 'none';
            }
        });
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è —Ä–∞–¥–∏—É—Å–∞
        alarmRadius.addEventListener('input', function() {
            radiusValue.textContent = `${this.value} –º`;
        });
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –≥—Ä–æ–º–∫–æ—Å—Ç–∏
        defaultVolume.addEventListener('input', function() {
            volumeValue.textContent = `${this.value}%`;
        });
        
        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∫–ª–∞–¥–æ–∫
        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                const tabId = tab.getAttribute('data-tab');
                
                // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —É –≤—Å–µ—Ö –≤–∫–ª–∞–¥–æ–∫ –∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
                tabs.forEach(t => t.classList.remove('active'));
                tabContents.forEach(c => c.classList.remove('active'));
                
                // –î–æ–±–∞–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å –∫ –≤—ã–±—Ä–∞–Ω–Ω–æ–π –≤–∫–ª–∞–¥–∫–µ –∏ –∫–æ–Ω—Ç–µ–Ω—Ç—É
                tab.classList.add('active');
                document.getElementById(`${tabId}-tab`).classList.add('active');
            });
        });
        
        // –ö–Ω–æ–ø–∫–∞ —Å–º–µ–Ω—ã —Ç–µ–º—ã
        themeBtn.addEventListener('click', function() {
            // –¶–∏–∫–ª–∏—á–µ—Å–∫–∏ –º–µ–Ω—è–µ–º —Ç–µ–º—ã
            const themes = ['blue', 'green', 'purple', 'dark', 'orange', 'black', 'white', 'red'];
            const currentIndex = themes.indexOf(currentTheme);
            const nextIndex = (currentIndex + 1) % themes.length;
            applyTheme(themes[nextIndex]);
            saveSettings();
        });
        
        // –ö–Ω–æ–ø–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤
        contactsBtn.addEventListener('click', function() {
            // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º –Ω–∞ –≤–∫–ª–∞–¥–∫—É –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤
            tabs.forEach(t => t.classList.remove('active'));
            tabContents.forEach(c => c.classList.remove('active'));
            
            document.querySelector('.tab[data-tab="contacts"]').classList.add('active');
            document.getElementById('contacts-tab').classList.add('active');
        });
        
        // –ö–Ω–æ–ø–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫
        settingsBtn.addEventListener('click', function() {
            settingsModal.classList.add('active');
        });
        
        // –ö–Ω–æ–ø–∫–∞ –∑–∞–∫—Ä—ã—Ç–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫
        closeSettingsBtn.addEventListener('click', function() {
            settingsModal.classList.remove('active');
        });
        
        // –ö–Ω–æ–ø–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫
        saveSettingsBtn.addEventListener('click', function() {
            saveSettings();
            settingsModal.classList.remove('active');
        });
        
        // –í—ã–±–æ—Ä —Ç–µ–º—ã
        themeOptions.forEach(option => {
            option.addEventListener('click', function() {
                const theme = this.getAttribute('data-theme');
                applyTheme(theme);
            });
        });
        
        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –∑–≤—É–∫–∞ –≤ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ
        soundToggle.addEventListener('click', function() {
            this.classList.toggle('active');
            
            if (this.classList.contains('active')) {
                // –í–∫–ª—é—á–∞–µ–º –∑–≤—É–∫
                if (alarmAudio) {
                    if (fadeInVolume.checked) {
                        startFadeInVolume();
                    } else {
                        alarmAudio.volume = parseInt(defaultVolume.value) / 100;
                    }
                }
            } else {
                // –û—Ç–∫–ª—é—á–∞–µ–º –∑–≤—É–∫
                if (alarmAudio) {
                    alarmAudio.volume = 0;
                    if (fadeInInterval) {
                        clearInterval(fadeInInterval);
                        fadeInInterval = null;
                    }
                }
            }
        });
        
        // –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–µ —É–≤–µ–ª–∏—á–µ–Ω–∏–µ –≥—Ä–æ–º–∫–æ—Å—Ç–∏
        function startFadeInVolume() {
            if (fadeInInterval) {
                clearInterval(fadeInInterval);
            }
            
            let currentVolume = 0;
            const targetVolume = parseInt(defaultVolume.value) / 100;
            const fadeInDuration = 30000; // 30 —Å–µ–∫—É–Ω–¥
            const steps = fadeInDuration / 100; // —à–∞–≥–∏ –ø–æ 100 –º—Å
            const volumeStep = targetVolume / steps;
            
            alarmAudio.volume = currentVolume;
            
            fadeInInterval = setInterval(() => {
                currentVolume += volumeStep;
                if (currentVolume >= targetVolume) {
                    currentVolume = targetVolume;
                    clearInterval(fadeInInterval);
                    fadeInInterval = null;
                }
                alarmAudio.volume = currentVolume;
            }, 100);
        }
        
        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –∑–∞–¥–∞—á–∏
        function generateMathProblem() {
            const operations = ['+', '-', '*'];
            const operation = operations[Math.floor(Math.random() * operations.length)];
            let num1, num2, answer;
            
            switch(operation) {
                case '+':
                    num1 = Math.floor(Math.random() * 10) + 1;
                    num2 = Math.floor(Math.random() * 10) + 1;
                    answer = num1 + num2;
                    break;
                case '-':
                    num1 = Math.floor(Math.random() * 10) + 1;
                    num2 = Math.floor(Math.random() * num1) + 1;
                    answer = num1 - num2;
                    break;
                case '*':
                    num1 = Math.floor(Math.random() * 5) + 1;
                    num2 = Math.floor(Math.random() * 5) + 1;
                    answer = num1 * num2;
                    break;
            }
            
            return {
                expression: `${num1} ${operation} ${num2}`,
                answer: answer
            };
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ—Ç–≤–µ—Ç–∞
        checkMathAnswer.addEventListener('click', function() {
            const userAnswer = parseInt(mathAnswer.value);
            const correctAnswer = parseInt(this.getAttribute('data-correct-answer'));
            
            if (userAnswer === correctAnswer) {
                mathAnswerCorrect = true;
                dismissBtn.disabled = false;
                mathProblem.style.display = 'none';
                alert("–ü—Ä–∞–≤–∏–ª—å–Ω–æ! –ë—É–¥–∏–ª—å–Ω–∏–∫ –º–æ–∂–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å.");
            } else {
                alert("–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ! –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.");
                mathAnswer.value = '';
                mathAnswer.focus();
            }
        });
        
        // –ö–Ω–æ–ø–∫–∞ "–û—Ç–ª–æ–∂–∏—Ç—å" –≤ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ
        snoozeBtn.addEventListener('click', function() {
            if (activeAlarmModal) {
                // –û—Ç–∫–ª–∞–¥—ã–≤–∞–µ–º –±—É–¥–∏–ª—å–Ω–∏–∫ –Ω–∞ 5 –º–∏–Ω—É—Ç
                activeAlarmModal.active = false;
                setTimeout(() => {
                    activeAlarmModal.active = true;
                }, 5 * 60 * 1000); // 5 –º–∏–Ω—É—Ç
                
                closeAlarmModal();
            }
        });
        
        // –ö–Ω–æ–ø–∫–∞ "–û—Ç–∫–ª—é—á–∏—Ç—å" –≤ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ
        dismissBtn.addEventListener('click', function() {
            if (activeAlarmModal) {
                // –û—Ç–∫–ª—é—á–∞–µ–º –±—É–¥–∏–ª—å–Ω–∏–∫
                activeAlarmModal.active = false;
                
                // –ï—Å–ª–∏ —ç—Ç–æ –≤—Ä–µ–º–µ–Ω–Ω—ã–π –±—É–¥–∏–ª—å–Ω–∏–∫ –Ω–∞ –æ–¥–∏–Ω —Ä–∞–∑, —É–¥–∞–ª—è–µ–º –µ–≥–æ
                if (activeAlarmModal.type === 'time' && activeAlarmModal.repeat === 'once') {
                    deleteAlarm(activeAlarmModal.id);
                }
                
                closeAlarmModal();
            }
        });
        
        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –±—É–¥–∏–ª—å–Ω–∏–∫–∞
        function closeAlarmModal() {
            alarmModal.classList.remove('active');
            
            // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–≤—É–∫
            if (alarmAudio) {
                alarmAudio.pause();
                alarmAudio.currentTime = 0;
                alarmAudio = null;
            }
            
            // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–µ —É–≤–µ–ª–∏—á–µ–Ω–∏–µ –≥—Ä–æ–º–∫–æ—Å—Ç–∏
            if (fadeInInterval) {
                clearInterval(fadeInInterval);
                fadeInInterval = null;
            }
            
            // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤–∏–±—Ä–∞—Ü–∏—é
            if (navigator.vibrate) {
                navigator.vibrate(0);
            }
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫—É—é –∑–∞–¥–∞—á—É
            mathProblem.style.display = 'none';
            mathAnswer.value = '';
            dismissBtn.disabled = true;
            mathAnswerCorrect = false;
            
            activeAlarmModal = null;
            alarmStatus.textContent = "–°–∏—Å—Ç–µ–º–∞ –∞–∫—Ç–∏–≤–Ω–∞";
            alarmStatus.classList.remove('alarm-active');
        }
        
        // –°–æ–∑–¥–∞–Ω–∏–µ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ —Å–∏–≥–Ω–∞–ª–∞ –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ –∫–∞—Ä—Ç–µ
        map.on('click', function(e) {
            const alarmName = document.getElementById('alarmName').value || `–°–∏–≥–Ω–∞–ª ${alarms.length + 1}`;
            const alarmMessage = document.getElementById('alarmMessage').value || "–í—ã –¥–æ—Å—Ç–∏–≥–ª–∏ —Ü–µ–ª–∏!";
            const radius = parseInt(alarmRadius.value);
            const soundType = document.getElementById('alarmSound').value;
            let customSoundIndex = null;
            
            if (soundType === 'custom') {
                customSoundIndex = parseInt(selectedCustomSound.value);
                if (isNaN(customSoundIndex)) {
                    alert("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∑–≤—É–∫");
                    return;
                }
            }
            
            createLocationAlarm(e.latlng, alarmName, alarmMessage, radius, soundType, customSoundIndex);
        });
        
        // –§—É–Ω–∫—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∏—è –≥–µ–æ–ª–æ–∫–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ —Å–∏–≥–Ω–∞–ª–∞
        function createLocationAlarm(latlng, name, message, radius, soundType, customSoundIndex) {
            const alarmId = 'alarm_' + Date.now();
            
            // –°–æ–∑–¥–∞–µ–º –≤–∏–∑—É–∞–ª—å–Ω–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —Å–∏–≥–Ω–∞–ª–∞
            const alarmCircle = L.circle(latlng, {
                color: currentTheme === 'dark' ? '#37474F' : '#4A6FA5',
                fillColor: currentTheme === 'dark' ? '#37474F' : '#4A6FA5',
                fillOpacity: 0.2,
                radius: radius
            }).addTo(map);
            
            const alarmMarker = L.marker(latlng).addTo(map).bindPopup(`
                <div style="text-align: center; padding: 10px;">
                    <h3 style="margin: 0 0 10px 0; color: ${currentTheme === 'dark' ? '#37474F' : '#4A6FA5'};">${name}</h3>
                    <p style="margin: 0;">${message}</p>
                    <p style="margin: 10px 0 0 0; font-size: 0.9em; color: #777;">–†–∞–¥–∏—É—Å: ${radius} –º</p>
                </div>
            `);
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–∏–≥–Ω–∞–ª
            const alarm = {
                id: alarmId,
                type: 'location',
                name: name,
                message: message,
                latlng: latlng,
                radius: radius,
                soundType: soundType,
                customSoundIndex: customSoundIndex,
                circle: alarmCircle,
                marker: alarmMarker,
                active: true
            };
            
            alarms.push(alarm);
            updateAlarmsList();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å
            alarmStatus.textContent = `–ì–µ–æ—Å–∏–≥–Ω–∞–ª "${name}" —Å–æ–∑–¥–∞–Ω!`;
            setTimeout(() => {
                alarmStatus.textContent = "–°–∏—Å—Ç–µ–º–∞ –∞–∫—Ç–∏–≤–Ω–∞";
            }, 3000);
        }
        
        // –§—É–Ω–∫—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∏—è –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ –±—É–¥–∏–ª—å–Ω–∏–∫–∞
        function createTimeAlarm() {
            const alarmName = document.getElementById('timeAlarmName').value || `–ë—É–¥–∏–ª—å–Ω–∏–∫ ${alarms.length + 1}`;
            const alarmMessage = document.getElementById('timeAlarmMessage').value || "–í—Ä–µ–º—è –ø—Ä–∏—à–ª–æ!";
            const alarmTime = document.getElementById('alarmTime').value;
            const repeatDays = document.getElementById('repeatDays').value;
            const soundType = document.getElementById('timeAlarmSound').value;
            let customSoundIndex = null;
            
            if (!alarmTime) {
                alert("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –≤—Ä–µ–º—è –¥–ª—è –±—É–¥–∏–ª—å–Ω–∏–∫–∞");
                return;
            }
            
            if (soundType === 'custom') {
                customSoundIndex = parseInt(timeSelectedCustomSound.value);
                if (isNaN(customSoundIndex)) {
                    alert("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∑–≤—É–∫");
                    return;
                }
            }
            
            const alarmId = 'alarm_' + Date.now();
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –±—É–¥–∏–ª—å–Ω–∏–∫
            const alarm = {
                id: alarmId,
                type: 'time',
                name: alarmName,
                message: alarmMessage,
                time: alarmTime,
                repeat: repeatDays,
                soundType: soundType,
                customSoundIndex: customSoundIndex,
                active: true
            };
            
            alarms.push(alarm);
            updateAlarmsList();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å
            alarmStatus.textContent = `–ë—É–¥–∏–ª—å–Ω–∏–∫ "${alarmName}" –Ω–∞ ${alarmTime} —Å–æ–∑–¥–∞–Ω!`;
            setTimeout(() => {
                alarmStatus.textContent = "–°–∏—Å—Ç–µ–º–∞ –∞–∫—Ç–∏–≤–Ω–∞";
            }, 3000);
        }
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ —Å–æ–∑–¥–∞–Ω–∏—è –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ –±—É–¥–∏–ª—å–Ω–∏–∫–∞
        createTimeAlarmBtn.addEventListener('click', createTimeAlarm);
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —Å–∏–≥–Ω–∞–ª–æ–≤
        function updateAlarmsList() {
            alarmsList.innerHTML = '';
            activeAlarmsCount.textContent = alarms.length;
            
            if (alarms.length === 0) {
                alarmsList.innerHTML = '<div class="alarm-item"><span class="alarm-name">–ü–æ–∫–∞ –Ω–µ—Ç —Å–∏–≥–Ω–∞–ª–æ–≤</span></div>';
                return;
            }
            
            alarms.forEach(alarm => {
                const alarmElement = document.createElement('div');
                alarmElement.className = 'alarm-item';
                if (alarm === closestAlarm) {
                    alarmElement.classList.add('active-alarm');
                }
                
                let details = '';
                if (alarm.type === 'location') {
                    details = `${alarm.radius} –º`;
                } else if (alarm.type === 'time') {
                    details = `${alarm.time} (${getRepeatText(alarm.repeat)})`;
                }
                
                // –î–æ–±–∞–≤–ª—è–µ–º –∏–∫–æ–Ω–∫—É —Ç–∏–ø–∞ –∑–≤—É–∫–∞
                let soundIcon = 'üîä';
                if (alarm.soundType === 'custom') {
                    soundIcon = 'üéµ';
                } else if (alarm.soundType === 'melodic') {
                    soundIcon = 'üé∂';
                }
                
                alarmElement.innerHTML = `
                    <div>
                        <div class="alarm-name">${soundIcon} ${alarm.name}</div>
                        <div class="alarm-details">${details}</div>
                    </div>
                    <button class="delete-alarm" data-id="${alarm.id}">√ó</button>
                `;
                
                alarmsList.appendChild(alarmElement);
            });
            
            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ —É–¥–∞–ª–µ–Ω–∏—è
            document.querySelectorAll('.delete-alarm').forEach(button => {
                button.addEventListener('click', function() {
                    const alarmId = this.getAttribute('data-id');
                    deleteAlarm(alarmId);
                });
            });
        }
        
        // –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –¥–ª—è –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è
        function getRepeatText(repeat) {
            switch(repeat) {
                case 'once': return '–æ–¥–∏–Ω —Ä–∞–∑';
                case 'daily': return '–µ–∂–µ–¥–Ω–µ–≤–Ω–æ';
                case 'weekdays': return '–ø–æ –±—É–¥–Ω—è–º';
                case 'weekends': return '–ø–æ –≤—ã—Ö–æ–¥–Ω—ã–º';
                default: return repeat;
            }
        }
        
        // –£–¥–∞–ª–µ–Ω–∏–µ —Å–∏–≥–Ω–∞–ª–∞
        function deleteAlarm(alarmId) {
            const alarmIndex = alarms.findIndex(a => a.id === alarmId);
            if (alarmIndex !== -1) {
                // –ï—Å–ª–∏ —ç—Ç–æ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–æ–Ω–Ω—ã–π —Å–∏–≥–Ω–∞–ª, —É–¥–∞–ª—è–µ–º —Å –∫–∞—Ä—Ç—ã
                if (alarms[alarmIndex].type === 'location') {
                    map.removeLayer(alarms[alarmIndex].circle);
                    map.removeLayer(alarms[alarmIndex].marker);
                }
                
                // –£–¥–∞–ª—è–µ–º –∏–∑ –º–∞—Å—Å–∏–≤–∞
                alarms.splice(alarmIndex, 1);
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫
                updateAlarmsList();
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å
                alarmStatus.textContent = "–°–∏–≥–Ω–∞–ª —É–¥–∞–ª–µ–Ω";
                setTimeout(() => {
                    alarmStatus.textContent = "–°–∏—Å—Ç–µ–º–∞ –∞–∫—Ç–∏–≤–Ω–∞";
                }, 3000);
            }
        }
        
        // –û—á–∏—Å—Ç–∫–∞ –≤—Å–µ—Ö —Å–∏–≥–Ω–∞–ª–æ–≤
        clearAlarmsBtn.addEventListener('click', function() {
            if (alarms.length === 0) return;
            
            if (confirm("–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –≤—Å–µ —Å–∏–≥–Ω–∞–ª—ã?")) {
                alarms.forEach(alarm => {
                    if (alarm.type === 'location') {
                        map.removeLayer(alarm.circle);
                        map.removeLayer(alarm.marker);
                    }
                });
                
                alarms = [];
                updateAlarmsList();
                closestAlarm = null;
                distanceInfo.textContent = "-";
                distanceInfo.classList.remove('active');
                
                alarmStatus.textContent = "–í—Å–µ —Å–∏–≥–Ω–∞–ª—ã —É–¥–∞–ª–µ–Ω—ã";
                setTimeout(() => {
                    alarmStatus.textContent = "–°–∏—Å—Ç–µ–º–∞ –∞–∫—Ç–∏–≤–Ω–∞";
                }, 3000);
            }
        });
        
        // –¢–µ—Å—Ç–æ–≤—ã–π —Å–∏–≥–Ω–∞–ª
        testAlarmBtn.addEventListener('click', function() {
            triggerAlarm({
                name: "–¢–µ—Å—Ç–æ–≤—ã–π —Å–∏–≥–Ω–∞–ª",
                message: "–≠—Ç–æ —Ç–µ—Å—Ç–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ!",
                soundType: "standard"
            });
        });
        
        // –ö–Ω–æ–ø–∫–∞ "–ù–∞–π—Ç–∏ –º–µ–Ω—è"
        locateUserBtn.addEventListener('click', function() {
            if (userMarker) {
                map.setView(userMarker.getLatLng(), 16);
            } else {
                getUserLocation();
            }
        });
        
        // –ö–Ω–æ–ø–∫–∞ "–°–ª–µ–¥–∏—Ç—å –∑–∞ –º–Ω–æ–π"
        trackUserBtn.addEventListener('click', function() {
            isTracking = !isTracking;
            if (isTracking) {
                trackUserBtn.style.background = 'var(--accent)';
                trackUserBtn.title = '–û—Ç–∫–ª—é—á–∏—Ç—å —Å–ª–µ–∂–µ–Ω–∏–µ';
                if (userMarker) {
                    map.setView(userMarker.getLatLng(), 16);
                }
            } else {
                trackUserBtn.style.background = 'var(--primary)';
                trackUserBtn.title = '–°–ª–µ–¥–∏—Ç—å –∑–∞ –º–Ω–æ–π';
            }
        });
        
        // –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        function getUserLocation() {
            if (navigator.geolocation) {
                // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–µ–µ –ø–æ–ª–æ–∂–µ–Ω–∏–µ –æ–¥–∏–Ω —Ä–∞–∑
                navigator.geolocation.getCurrentPosition(
                    function(position) {
                        updateUserPosition(position);
                    },
                    function(error) {
                        locationStatus.textContent = '–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è: ' + error.message;
                    },
                    {
                        enableHighAccuracy: highAccuracy.checked,
                        timeout: 10000,
                        maximumAge: 0
                    }
                );
                
                // –ù–∞—á–∏–Ω–∞–µ–º –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è
                if (watchId) {
                    navigator.geolocation.clearWatch(watchId);
                }
                
                watchId = navigator.geolocation.watchPosition(
                    function(position) {
                        updateUserPosition(position);
                        checkLocationAlarms();
                    },
                    function(error) {
                        locationStatus.textContent = '–û—à–∏–±–∫–∞ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è: ' + error.message;
                    },
                    {
                        enableHighAccuracy: highAccuracy.checked,
                        timeout: 10000,
                        maximumAge: 1000
                    }
                );
            } else {
                locationStatus.textContent = '–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –≤–∞—à–∏–º –±—Ä–∞—É–∑–µ—Ä–æ–º';
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ –∫–∞—Ä—Ç–µ
        function updateUserPosition(position) {
            const userLatLng = [position.coords.latitude, position.coords.longitude];
            const accuracy = position.coords.accuracy;
            
            // –ï—Å–ª–∏ —ç—Ç–æ –ø–µ—Ä–≤—ã–π —Ä–∞–∑, —Ü–µ–Ω—Ç—Ä–∏—Ä—É–µ–º –∫–∞—Ä—Ç—É
            if (!userMarker) {
                map.setView(userLatLng, 16);
                
                // –°–æ–∑–¥–∞–µ–º –º–∞—Ä–∫–µ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –∫–∞—Å—Ç–æ–º–Ω–æ–π –∏–∫–æ–Ω–∫–æ–π
                userMarker = L.marker(userLatLng, {
                    icon: L.divIcon({
                        className: 'user-location-marker',
                        html: '<div class="user-location-marker"></div>',
                        iconSize: [20, 20],
                        iconAnchor: [10, 10]
                    })
                }).addTo(map).bindPopup('–í–∞—à–µ —Ç–µ–∫—É—â–µ–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ');
                
                // –°–æ–∑–¥–∞–µ–º –∫—Ä—É–≥ —Ç–æ—á–Ω–æ—Å—Ç–∏
                userAccuracyCircle = L.circle(userLatLng, {
                    color: '#FF6B6B',
                    fillColor: '#FF6B6B',
                    fillOpacity: 0.2,
                    radius: accuracy
                }).addTo(map);
            } else {
                userMarker.setLatLng(userLatLng);
                userAccuracyCircle.setLatLng(userLatLng);
                userAccuracyCircle.setRadius(accuracy);
            }
            
            // –ï—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–æ –∞–≤—Ç–æ-—Å–ª–µ–∂–µ–Ω–∏–µ, —Ü–µ–Ω—Ç—Ä–∏—Ä—É–µ–º –∫–∞—Ä—Ç—É –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
            if (isTracking || autoTracking.checked) {
                map.setView(userLatLng, map.getZoom());
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å
            locationStatus.textContent = `–®–∏—Ä–æ—Ç–∞: ${userLatLng[0].toFixed(6)}, –î–æ–ª–≥–æ—Ç–∞: ${userLatLng[1].toFixed(6)}`;
            locationStatus.innerHTML += `<br>–¢–æ—á–Ω–æ—Å—Ç—å: ${Math.round(accuracy)} –º`;
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è –¥–æ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤
        function checkLocationAlarms() {
            if (!userMarker || alarms.length === 0) return;
            
            const userLatLng = userMarker.getLatLng();
            let minDistance = Infinity;
            let closest = null;
            
            // –ù–∞—Ö–æ–¥–∏–º –±–ª–∏–∂–∞–π—à–∏–π —Å–∏–≥–Ω–∞–ª
            alarms.forEach(alarm => {
                if (alarm.type !== 'location') return;
                
                const distance = userLatLng.distanceTo(alarm.latlng);
                
                if (distance < minDistance) {
                    minDistance = distance;
                    closest = alarm;
                }
                
                // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ —Ä–∞–¥–∏—É—Å–µ —Å–∏–≥–Ω–∞–ª–∞
                if (distance <= alarm.radius && alarm.active) {
                    // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º —Å–∏–≥–Ω–∞–ª
                    triggerAlarm(alarm);
                    
                    // –î–µ–∞–∫—Ç–∏–≤–∏—Ä—É–µ–º –Ω–∞ –Ω–µ–∫–æ—Ç–æ—Ä–æ–µ –≤—Ä–µ–º—è
                    alarm.active = false;
                    setTimeout(() => {
                        alarm.active = true;
                    }, 30000); // 30 —Å–µ–∫—É–Ω–¥
                }
            });
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –±–ª–∏–∂–∞–π—à–µ–º —Å–∏–≥–Ω–∞–ª–µ
            closestAlarm = closest;
            if (closest) {
                distanceInfo.textContent = `${Math.round(minDistance)} –º –¥–æ "${closest.name}"`;
                distanceInfo.classList.add('active');
            } else {
                distanceInfo.textContent = "-";
                distanceInfo.classList.remove('active');
            }
            
            updateAlarmsList();
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –±—É–¥–∏–ª—å–Ω–∏–∫–æ–≤
        function checkTimeAlarms() {
            const now = new Date();
            const currentTimeString = now.toTimeString().substring(0, 5);
            
            alarms.forEach(alarm => {
                if (alarm.type !== 'time') return;
                
                if (alarm.time === currentTimeString && alarm.active) {
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω—É–∂–Ω–æ –ª–∏ —Å—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é
                    if (shouldTriggerTimeAlarm(alarm, now)) {
                        triggerAlarm(alarm);
                        
                        // –ï—Å–ª–∏ –±—É–¥–∏–ª—å–Ω–∏–∫ –Ω–∞ –æ–¥–∏–Ω —Ä–∞–∑, –¥–µ–∞–∫—Ç–∏–≤–∏—Ä—É–µ–º –µ–≥–æ
                        if (alarm.repeat === 'once') {
                            alarm.active = false;
                        }
                    }
                }
            });
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞, –¥–æ–ª–∂–µ–Ω –ª–∏ —Å—Ä–∞–±–æ—Ç–∞—Ç—å –≤—Ä–µ–º–µ–Ω–Ω–æ–π –±—É–¥–∏–ª—å–Ω–∏–∫
        function shouldTriggerTimeAlarm(alarm, now) {
            const dayOfWeek = now.getDay(); // 0 - –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ, 1 - –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫, –∏ —Ç.–¥.
            
            switch(alarm.repeat) {
                case 'once':
                    return true;
                case 'daily':
                    return true;
                case 'weekdays':
                    return dayOfWeek >= 1 && dayOfWeek <= 5;
                case 'weekends':
                    return dayOfWeek === 0 || dayOfWeek === 6;
                default:
                    return true;
            }
        }
        
        // –ê–∫—Ç–∏–≤–∞—Ü–∏—è —Å–∏–≥–Ω–∞–ª–∞
        function triggerAlarm(alarm) {
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –±—É–¥–∏–ª—å–Ω–∏–∫ –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
            activeAlarmModal = alarm;
            
            // –ó–∞–ø–æ–ª–Ω—è–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
            modalMessage.textContent = alarm.message;
            modalName.textContent = alarm.name;
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –∑–≤—É–∫–∞
            soundToggle.classList.add('active');
            
            // –ï—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω—ã –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞–Ω–∏—è, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–¥–∞—á—É
            if (mathProblems.checked) {
                const mathProblemData = generateMathProblem();
                mathExpression.textContent = mathProblemData.expression;
                checkMathAnswer.setAttribute('data-correct-answer', mathProblemData.answer);
                mathProblem.style.display = 'block';
                dismissBtn.disabled = true;
                mathAnswer.focus();
            } else {
                mathProblem.style.display = 'none';
                dismissBtn.disabled = false;
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
            alarmModal.classList.add('active');
            
            // –í–∏–∑—É–∞–ª—å–Ω–æ–µ –æ–ø–æ–≤–µ—â–µ–Ω–∏–µ –≤ —Å—Ç–∞—Ç—É—Å–µ
            alarmStatus.textContent = `–°–ò–ì–ù–ê–õ: ${alarm.message}`;
            alarmStatus.classList.add('alarm-active');
            
            // –ó–≤—É–∫–æ–≤–æ–µ –æ–ø–æ–≤–µ—â–µ–Ω–∏–µ
            playAlarmSound(alarm);
            
            // –í–∏–±—Ä–∞—Ü–∏—è (–µ—Å–ª–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –∏ –≤–∫–ª—é—á–µ–Ω–∞ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö)
            if (navigator.vibrate && vibrationSetting.checked) {
                navigator.vibrate([200, 100, 200, 100, 200, 100, 500]);
            }
        }
        
        // –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∑–≤—É–∫–∞ —Å–∏–≥–Ω–∞–ª–∞
        function playAlarmSound(alarm) {
            // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π –∑–≤—É–∫, –µ—Å–ª–∏ –æ–Ω –µ—Å—Ç—å
            if (alarmAudio) {
                alarmAudio.pause();
                alarmAudio.currentTime = 0;
            }
            
            try {
                if (alarm.soundType === 'custom' && alarm.customSoundIndex !== null) {
                    // –í–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∑–≤—É–∫
                    const soundIndex = alarm.customSoundIndex;
                    if (soundIndex >= 0 && soundIndex < customSounds.length) {
                        const sound = customSounds[soundIndex];
                        alarmAudio = new Audio(sound.data);
                        alarmAudio.loop = true;
                        
                        if (fadeInVolume.checked) {
                            startFadeInVolume();
                        } else {
                            alarmAudio.volume = parseInt(defaultVolume.value) / 100;
                        }
                        
                        alarmAudio.play().catch(e => {
                            console.log("–û—à–∏–±–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –∑–≤—É–∫–∞:", e);
                        });
                    }
                } else {
                    // –°–æ–∑–¥–∞–µ–º –∞—É–¥–∏–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∑–≤—É–∫–∞
                    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);
                    
                    // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∑–≤—É–∫–∞ –±—É–¥–∏–ª—å–Ω–∏–∫–∞
                    if (alarm.soundType === 'melodic') {
                        // –ú–µ–ª–æ–¥–∏—á–Ω—ã–π –∑–≤–æ–Ω
                        oscillator.type = 'sine';
                        oscillator.frequency.setValueAtTime(523.25, audioContext.currentTime); // C5
                        oscillator.frequency.setValueAtTime(659.25, audioContext.currentTime + 0.5); // E5
                        oscillator.frequency.setValueAtTime(783.99, audioContext.currentTime + 1.0); // G5
                    } else {
                        // –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Å–∏–≥–Ω–∞–ª
                        oscillator.type = 'square';
                        oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
                        oscillator.frequency.exponentialRampToValueAtTime(400, audioContext.currentTime + 0.5);
                    }
                    
                    if (fadeInVolume.checked) {
                        gainNode.gain.setValueAtTime(0, audioContext.currentTime);
                        gainNode.gain.exponentialRampToValueAtTime(parseInt(defaultVolume.value) / 200, audioContext.currentTime + 30);
                    } else {
                        gainNode.gain.setValueAtTime(parseInt(defaultVolume.value) / 200, audioContext.currentTime);
                    }
                    
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 1);
                    
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 1);
                    
                    // –ü–æ–≤—Ç–æ—Ä—è–µ–º –∑–≤—É–∫ –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É
                    const soundInterval = setInterval(() => {
                        if (!alarmModal.classList.contains('active')) {
                            clearInterval(soundInterval);
                            return;
                        }
                        
                        const oscillator2 = audioContext.createOscillator();
                        const gainNode2 = audioContext.createGain();
                        
                        oscillator2.connect(gainNode2);
                        gainNode2.connect(audioContext.destination);
                        
                        if (alarm.soundType === 'melodic') {
                            oscillator2.type = 'sine';
                            oscillator2.frequency.setValueAtTime(523.25, audioContext.currentTime);
                            oscillator2.frequency.setValueAtTime(659.25, audioContext.currentTime + 0.5);
                            oscillator2.frequency.setValueAtTime(783.99, audioContext.currentTime + 1.0);
                        } else {
                            oscillator2.type = 'square';
                            oscillator2.frequency.setValueAtTime(800, audioContext.currentTime);
                            oscillator2.frequency.exponentialRampToValueAtTime(400, audioContext.currentTime + 0.5);
                        }
                        
                        if (fadeInVolume.checked) {
                            gainNode2.gain.setValueAtTime(0, audioContext.currentTime);
                            gainNode2.gain.exponentialRampToValueAtTime(parseInt(defaultVolume.value) / 200, audioContext.currentTime + 30);
                        } else {
                            gainNode2.gain.setValueAtTime(parseInt(defaultVolume.value) / 200, audioContext.currentTime);
                        }
                        
                        gainNode2.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 1);
                        
                        oscillator2.start(audioContext.currentTime);
                        oscillator2.stop(audioContext.currentTime + 1);
                    }, 1500);
                }
            } catch(e) {
                console.log("–û—à–∏–±–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –∑–≤—É–∫–∞:", e);
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
        function updateCurrentTime() {
            const now = new Date();
            const timeString = now.toTimeString().substring(0, 8);
            currentTime.textContent = timeString;
        }
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ —Å–æ–∑–¥–∞–Ω–∏—è –≥–µ–æ–ª–æ–∫–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ —Å–∏–≥–Ω–∞–ª–∞
        createAlarmBtn.addEventListener('click', function() {
            alert("–ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –∫–∞—Ä—Ç–µ, —á—Ç–æ–±—ã —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≥–µ–æ–ª–æ–∫–∞—Ü–∏–æ–Ω–Ω—ã–π —Å–∏–≥–Ω–∞–ª");
        });
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.addEventListener('load', function() {
            getUserLocation();
            loadCustomSounds();
            loadSettings();
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏
            updateCurrentTime();
            currentTimeInterval = setInterval(updateCurrentTime, 1000);
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –±—É–¥–∏–ª—å–Ω–∏–∫–æ–≤
            setInterval(checkTimeAlarms, 1000);
            
            // –°–æ–∑–¥–∞–µ–º –¥–µ–º–æ-—Å–∏–≥–Ω–∞–ª
            setTimeout(() => {
                if (alarms.length === 0) {
                    const demoLatLng = map.getCenter();
                    demoLatLng.lat += 0.005;
                    demoLatLng.lng += 0.005;
                    
                    createLocationAlarm(
                        demoLatLng, 
                        "–ü—Ä–∏–º–µ—Ä –≥–µ–æ—Å–∏–≥–Ω–∞–ª–∞", 
                        "–í—ã –¥–æ—Å—Ç–∏–≥–ª–∏ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ —Å–∏–≥–Ω–∞–ª–∞!", 
                        300,
                        "standard"
                    );
                }
            }, 2000);
        });

        // PWA: Service Worker —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('/sw.js').then(function(registration) {
                    console.log('ServiceWorker registration successful with scope: ', registration.scope);
                }, function(err) {
                    console.log('ServiceWorker registration failed: ', err);
                });
            });
        }
    </script>
</body>
</html>
